<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.ceb1bd45d57a4d5a96cc.css">code[class*=language-],pre[class*=language-]{color:#000;background:none;text-shadow:0 1px #fff;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::-moz-selection,code[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection{text-shadow:none;background:#b3d4fc}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}@font-face{font-family:EB Garamond;font-style:normal;font-display:swap;font-weight:400;src:local("EB Garamond Regular "),local("EB Garamond-Regular"),url(/static/eb-garamond-latin-400-0b5e5cf1510265eaa35aef48280d9445.woff2) format("woff2"),url(/static/eb-garamond-latin-400-6e6dc1e2091a384c9736191635c76c7d.woff) format("woff")}@font-face{font-family:EB Garamond;font-style:italic;font-display:swap;font-weight:400;src:local("EB Garamond Regular italic"),local("EB Garamond-Regularitalic"),url(/static/eb-garamond-latin-400italic-35804dbadb146532ae90266c743677e9.woff2) format("woff2"),url(/static/eb-garamond-latin-400italic-7e083c055f80bee0dd3cbe7b24d46dd0.woff) format("woff")}@font-face{font-family:EB Garamond;font-style:normal;font-display:swap;font-weight:500;src:local("EB Garamond Medium "),local("EB Garamond-Medium"),url(/static/eb-garamond-latin-500-36fa841d6180ed44a1ce159ee2a010d5.woff2) format("woff2"),url(/static/eb-garamond-latin-500-1834476d4e1599f8b81a4cff3cdd228d.woff) format("woff")}@font-face{font-family:EB Garamond;font-style:italic;font-display:swap;font-weight:500;src:local("EB Garamond Medium italic"),local("EB Garamond-Mediumitalic"),url(/static/eb-garamond-latin-500italic-b87ddae79afda30427d5b719388f5a5c.woff2) format("woff2"),url(/static/eb-garamond-latin-500italic-08cc20973e3e6c1a087c8f1d6ad0bd2f.woff) format("woff")}@font-face{font-family:EB Garamond;font-style:normal;font-display:swap;font-weight:600;src:local("EB Garamond SemiBold "),local("EB Garamond-SemiBold"),url(/static/eb-garamond-latin-600-9e781f5f19bac785a772d7b13f3d1b8a.woff2) format("woff2"),url(/static/eb-garamond-latin-600-319543a8b1ec582b336c937b804df932.woff) format("woff")}@font-face{font-family:EB Garamond;font-style:italic;font-display:swap;font-weight:600;src:local("EB Garamond SemiBold italic"),local("EB Garamond-SemiBolditalic"),url(/static/eb-garamond-latin-600italic-594ac7029ba04b8f79ef0a0afeef9db7.woff2) format("woff2"),url(/static/eb-garamond-latin-600italic-a69fb84ad01d0565f39d3f351805c065.woff) format("woff")}@font-face{font-family:EB Garamond;font-style:normal;font-display:swap;font-weight:700;src:local("EB Garamond Bold "),local("EB Garamond-Bold"),url(/static/eb-garamond-latin-700-ad2e23782f6b92b4d0dc94bae5dacab8.woff2) format("woff2"),url(/static/eb-garamond-latin-700-9e3bb34e84c203a87c63f897ac368f5a.woff) format("woff")}@font-face{font-family:EB Garamond;font-style:italic;font-display:swap;font-weight:700;src:local("EB Garamond Bold italic"),local("EB Garamond-Bolditalic"),url(/static/eb-garamond-latin-700italic-d2ce5dad5317cebe5bf5af77d5bcf792.woff2) format("woff2"),url(/static/eb-garamond-latin-700italic-131abdd8ce2783f285aff7e00448ff7a.woff) format("woff")}@font-face{font-family:EB Garamond;font-style:normal;font-display:swap;font-weight:800;src:local("EB Garamond ExtraBold "),local("EB Garamond-ExtraBold"),url(/static/eb-garamond-latin-800-bbadeb8fefbdd2b587c58c5c8e509bc8.woff2) format("woff2"),url(/static/eb-garamond-latin-800-99fee78023579edc7b45279f7602fbae.woff) format("woff")}@font-face{font-family:EB Garamond;font-style:italic;font-display:swap;font-weight:800;src:local("EB Garamond ExtraBold italic"),local("EB Garamond-ExtraBolditalic"),url(/static/eb-garamond-latin-800italic-653c5e327a87dcdb8c74ec0898a7691d.woff2) format("woff2"),url(/static/eb-garamond-latin-800italic-ffe37ba0b583cabb20bbc3b9d7500f64.woff) format("woff")}.react-rotating-text-cursor{-webkit-animation:blinking-cursor .8s cubic-bezier(.68,.01,.01,.99) 0s infinite;animation:blinking-cursor .8s cubic-bezier(.68,.01,.01,.99) 0s infinite}@-webkit-keyframes blinking-cursor{0%{opacity:0}50%{opacity:1}to{opacity:0}}@keyframes blinking-cursor{0%{opacity:0}50%{opacity:1}to{opacity:0}}</style><meta name="generator" content="Gatsby 2.15.15"/><title data-react-helmet="true">Using EKS to Deploy all the Pull Requests | Featurist</title><meta data-react-helmet="true" name="description" content="Using EKS to Deploy all the Pull Requests"/><meta data-react-helmet="true" property="og:title" content="Using EKS to Deploy all the Pull Requests"/><meta data-react-helmet="true" property="og:description" content="Using EKS to Deploy all the Pull Requests"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" property="og:image" content="https://featurist.co.uk/favicons/social-192x192.png?v1"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="@featurists"/><meta data-react-helmet="true" name="twitter:site" content="@featurists"/><meta data-react-helmet="true" name="twitter:title" content="Using EKS to Deploy all the Pull Requests"/><meta data-react-helmet="true" name="twitter:description" content="Using EKS to Deploy all the Pull Requests"/><meta data-react-helmet="true" name="twitter:image" content="https://featurist.co.uk/favicons/social-192x192.png?v1"/><script data-react-helmet="true" async="" src="https://platform.twitter.com/widgets.js"></script><style data-styled="bvVRDd gzanlj ilWicQ dHtnML fCaQGl iPnDvY fxWQEF ojoGc bMecYs jDcGGz bLfLfh bUVWZV dGbbhL gRWWeC cLaGLl eFYSEN ZkiwD dbapCF ewwFgx cgkVAB pRQic loGAVl duUyde gvULkj kbxvwd jHKtjg gVWHDU gtTunZ idWTtV bfNQDu fcEJLH bLYTqr kkyNDe ezUiIG gGTliD kNTPos hkWMSW hqzNIg iOqZkn iNQBQW iProPY emjNbC" data-styled-version="4.3.2">
/* sc-component-id: sc-global-4081413881 */
*,*:before,*:after{box-sizing:inherit;} html{text-rendering:optimizeLegibility;overflow-x:hidden;box-sizing:border-box;-ms-overflow-style:scrollbar;-webkit-tap-highlight-color:rgba(245,246,244,0);background-color:#ffffff;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;} html,body{width:100%;height:100%;margin:0;padding:0;} body{color:transparent;-webkit-scroll-behavior:smooth;-moz-scroll-behavior:smooth;-ms-scroll-behavior:smooth;scroll-behavior:smooth;} h1,h2,h3,h4,h5{color:transparent;} a{color:#FF3D78;-webkit-text-decoration:none;text-decoration:none;} a:hover{-webkit-text-decoration:underline;text-decoration:underline;} body .tl-wrapper.tl-wrapper-status--entered{-webkit-transform:none !important;-ms-transform:none !important;transform:none !important;}
/* sc-component-id: Content__ContentFull-sc-1g3f5s5-3 */
.gVWHDU{width:100%;position:relative;padding-left:1.5rem;padding-right:1.5rem;background-color:#ffffff;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding-top:1.5rem;padding-bottom:1.5rem;text-align:center;padding:0;} @media (min-width:600px){.gVWHDU{padding-left:3rem;padding-right:3rem;}} @media (min-width:900px){.gVWHDU{padding-left:6rem;padding-right:6rem;}} @media (min-width:1600px){.gVWHDU{padding-left:8rem;padding-right:8rem;}} @media (min-width:600px){.gVWHDU{padding-top:3rem;padding-bottom:3rem;}} @media (min-width:900px){.gVWHDU{text-align:left;}} @media (min-width:600px){.gVWHDU{padding:0;}} @media (min-width:900px){.gVWHDU{padding:0;}} @media (min-width:1600px){.gVWHDU{padding-left:0;padding-right:0;}}
/* sc-component-id: Text__Strong-qowd5r-12 */
.jHKtjg{font-weight:700;}
/* sc-component-id: Navigation__NavLink-sc-1j36s24-0 */
.fCaQGl{font-size:1rem;font-family:"-apple-system","BlinkMacSystemFont","Segoe UI","Helvetica","Arial","sans-serif","Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";color:#2f392e;line-height:2;color:#767870;font-weight:normal;color:#767870;font-weight:normal;} @media (min-width:900px){.fCaQGl{font-size:1.125rem;}} .fCaQGl:hover{color:#2f392e;} .fCaQGl:hover{color:#2f392e;}
/* sc-component-id: Navigation__HashLink-sc-1j36s24-1 */
.cgkVAB{font-size:1rem;font-family:"-apple-system","BlinkMacSystemFont","Segoe UI","Helvetica","Arial","sans-serif","Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";color:#2f392e;line-height:2;color:#767870;font-weight:normal;color:#767870;font-weight:normal;} @media (min-width:900px){.cgkVAB{font-size:1.125rem;}} .cgkVAB:hover{color:#2f392e;} .cgkVAB:hover{color:#2f392e;}
/* sc-component-id: Navigation__StickyNavShadow-sc-1j36s24-2 */
.bvVRDd{height:72px;width:100%;}
/* sc-component-id: Navigation__Nav-sc-1j36s24-3 */
.ilWicQ{width:100%;position:relative;padding-left:1.5rem;padding-right:1.5rem;padding-top:1rem;padding-bottom:1rem;-webkit-transition:height 0.17s ease-out;transition:height 0.17s ease-out;} @media (min-width:600px){.ilWicQ{padding-left:3rem;padding-right:3rem;}} @media (min-width:900px){.ilWicQ{padding-left:6rem;padding-right:6rem;}} @media (min-width:1600px){.ilWicQ{padding-left:8rem;padding-right:8rem;}} @media only screen and (max-width:900px){.ilWicQ{height:72px;}}
/* sc-component-id: Navigation__NavInner-sc-1j36s24-4 */
.dHtnML{width:100%;margin-left:auto;margin-right:auto;text-align:center;position:relative;max-width:1600px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;} @media (min-width:900px){.dHtnML{text-align:left;}}
/* sc-component-id: Navigation__LogoWrapper-sc-1j36s24-5 */
.iPnDvY{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;color:#222b2f;margin-right:1rem;height:40px;} .iPnDvY:hover{color:#222b2f;}
/* sc-component-id: Navigation__Logo-sc-1j36s24-6 */
.fxWQEF{height:100%;}
/* sc-component-id: Navigation__HamburgerIcon-sc-1j36s24-7 */
.jDcGGz{position:relative;}
/* sc-component-id: Navigation__LineTop-sc-1j36s24-8 */
.bLfLfh{background-color:#767870;height:2px;width:26px;-webkit-transform-origin:left top;-ms-transform-origin:left top;transform-origin:left top;-webkit-transition:-webkit-transform 0.2s ease,opacity 0.2s;-webkit-transition:transform 0.2s ease,opacity 0.2s;transition:transform 0.2s ease,opacity 0.2s;-webkit-transform:none;-ms-transform:none;transform:none;}
/* sc-component-id: Navigation__LineMiddle-sc-1j36s24-9 */
.bUVWZV{background-color:#767870;height:2px;width:26px;-webkit-transform-origin:left top;-ms-transform-origin:left top;transform-origin:left top;-webkit-transition:-webkit-transform 0.2s ease,opacity 0.2s;-webkit-transition:transform 0.2s ease,opacity 0.2s;transition:transform 0.2s ease,opacity 0.2s;margin-top:5px;margin-bottom:5px;opacity:1;-webkit-transform:none;-ms-transform:none;transform:none;}
/* sc-component-id: Navigation__LineBottom-sc-1j36s24-10 */
.dGbbhL{background-color:#767870;height:2px;width:26px;-webkit-transform-origin:left top;-ms-transform-origin:left top;transform-origin:left top;-webkit-transition:-webkit-transform 0.2s ease,opacity 0.2s;-webkit-transition:transform 0.2s ease,opacity 0.2s;transition:transform 0.2s ease,opacity 0.2s;-webkit-transform:none;-ms-transform:none;transform:none;}
/* sc-component-id: Navigation__TriggerWrapper-sc-1j36s24-11 */
.ojoGc{display:block;} @media (min-width:900px){.ojoGc{display:none;}}
/* sc-component-id: Navigation__Trigger-sc-1j36s24-12 */
.bMecYs{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:0.75rem;cursor:pointer;} .bMecYs:hover .Navigation__LineTop-sc-1j36s24-8,.bMecYs:hover .Navigation__LineMiddle-sc-1j36s24-9,.bMecYs:hover .Navigation__LineBottom-sc-1j36s24-10{background-color:#2f392e;}
/* sc-component-id: Navigation__ListWrapper-sc-1j36s24-13 */
.gRWWeC{width:100%;display:block;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;display:none;} @media (min-width:900px){.gRWWeC{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:auto;}} @media (min-width:900px){.gRWWeC{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}
/* sc-component-id: Navigation__List-sc-1j36s24-14 */
.cLaGLl{font-size:1rem;text-align:right;} @media (min-width:900px){.cLaGLl{-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}}
/* sc-component-id: Navigation__ListItem-sc-1j36s24-15 */
.eFYSEN{cursor:pointer;margin-top:1rem;display:block;padding-left:1rem;padding-right:1rem;-webkit-animation-delay:0.1s;animation-delay:0.1s;} @media (min-width:900px){.eFYSEN{margin-top:0;}} @media (min-width:900px){.eFYSEN{display:inline-block;margin-right:1.5rem;}} @media (min-width:900px){.eFYSEN{padding-left:0;padding-right:0;}}.ZkiwD{cursor:pointer;margin-top:1rem;display:block;padding-left:1rem;padding-right:1rem;-webkit-animation-delay:0.2s;animation-delay:0.2s;} @media (min-width:900px){.ZkiwD{margin-top:0;}} @media (min-width:900px){.ZkiwD{display:inline-block;margin-right:1.5rem;}} @media (min-width:900px){.ZkiwD{padding-left:0;padding-right:0;}}.dbapCF{cursor:pointer;margin-top:1rem;display:block;padding-left:1rem;padding-right:1rem;-webkit-animation-delay:0.30000000000000004s;animation-delay:0.30000000000000004s;} @media (min-width:900px){.dbapCF{margin-top:0;}} @media (min-width:900px){.dbapCF{display:inline-block;margin-right:1.5rem;}} @media (min-width:900px){.dbapCF{padding-left:0;padding-right:0;}}.ewwFgx{cursor:pointer;margin-top:1rem;display:block;padding-left:1rem;padding-right:1rem;-webkit-animation-delay:0.4s;animation-delay:0.4s;} @media (min-width:900px){.ewwFgx{margin-top:0;}} @media (min-width:900px){.ewwFgx{display:inline-block;margin-right:1.5rem;}} @media (min-width:900px){.ewwFgx{padding-left:0;padding-right:0;}}
/* sc-component-id: Navigation___StyledStickyNav-sc-1j36s24-16 */
.gzanlj{background-color:#f5f6f4;z-index:30;width:100%;position:fixed !important;box-shadow:none;-webkit-transition:background-color 0.15s ease-out;transition:background-color 0.15s ease-out;} .gzanlj.pinned{background-color:#ffffff;border-bottom:solid 2px #f5f6f4;}
/* sc-component-id: CircleIcon__Wrapper-sc-1igkh6j-0 */
.fcEJLH{width:64px;height:64px;} .fcEJLH:hover > circle{stroke-dashoffset:0;}.bLYTqr{width:42px;height:42px;} .bLYTqr:hover > circle{stroke-dashoffset:0;}
/* sc-component-id: CircleIcon__Circle-sc-1igkh6j-1 */
.kkyNDe{stroke-dasharray:100;stroke-dashoffset:100;-webkit-transition:stroke-dashoffset 0.35s ease-out;transition:stroke-dashoffset 0.35s ease-out;}
/* sc-component-id: FooterContent__Footer-sc-14lp62o-0 */
.hkWMSW{width:100%;position:relative;padding-left:1.5rem;padding-right:1.5rem;padding-top:1rem;padding-bottom:1rem;} @media (min-width:600px){.hkWMSW{padding-left:3rem;padding-right:3rem;}} @media (min-width:900px){.hkWMSW{padding-left:6rem;padding-right:6rem;}} @media (min-width:1600px){.hkWMSW{padding-left:8rem;padding-right:8rem;}}
/* sc-component-id: FooterContent__FooterInner-sc-14lp62o-1 */
.hqzNIg{width:100%;margin-left:auto;margin-right:auto;text-align:center;position:relative;max-width:1600px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;font-family:"-apple-system","BlinkMacSystemFont","Segoe UI","Helvetica","Arial","sans-serif","Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";} @media (min-width:900px){.hqzNIg{text-align:left;}} @media (min-width:900px){.hqzNIg{-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;}}
/* sc-component-id: FooterContent__Copyright-sc-14lp62o-2 */
.iOqZkn{font-size:1rem;padding-top:0.25rem;color:#ebede8;text-align:center;} @media (min-width:900px){.iOqZkn{text-align:left;}}
/* sc-component-id: FooterContent__SocialWrapper-sc-14lp62o-3 */
.iNQBQW{width:100%;} @media (min-width:900px){.iNQBQW{width:auto;}}
/* sc-component-id: FooterContent__List-sc-14lp62o-4 */
.iProPY{font-size:1rem;text-align:center;padding-top:0.25rem;} @media (min-width:900px){.iProPY{text-align:left;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}}
/* sc-component-id: FooterContent__ListItem-sc-14lp62o-5 */
.emjNbC{font-size:1rem;font-family:"-apple-system","BlinkMacSystemFont","Segoe UI","Helvetica","Arial","sans-serif","Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";color:#2f392e;line-height:2;display:inline-block;margin-top:1rem;padding-left:1rem;padding-right:1rem;color:#ebede8;} @media (min-width:900px){.emjNbC{font-size:1.125rem;}} @media (min-width:900px){.emjNbC{margin-top:0;margin-right:1rem;}} @media (min-width:900px){.emjNbC{padding-left:0;padding-right:0;}} .emjNbC:hover{color:#ffffff;}
/* sc-component-id: layout__FooterBackground-sc-2sv4ue-0 */
.kNTPos{background:linear-gradient(to bottom,#102948 0%,#102031 100%);box-shadow:#0000006e 4px 4px 25px;position:relative;}
/* sc-component-id: PrevNext__Wrapper-fknkt2-0 */
@media (min-width:900px){.idWTtV{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}}
/* sc-component-id: PrevNext__Prev-fknkt2-1 */
.bfNQDu{font-size:.875rem;font-family:"-apple-system","BlinkMacSystemFont","Segoe UI","Helvetica","Arial","sans-serif","Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";color:#70818a;font-weight:600;text-transform:uppercase;margin-bottom:1rem;text-align:center;} @media (min-width:900px){.bfNQDu{margin-bottom:0;}} @media (min-width:900px){.bfNQDu{text-align:left;}}
/* sc-component-id: PrevNext__Next-fknkt2-2 */
.gGTliD{font-size:.875rem;font-family:"-apple-system","BlinkMacSystemFont","Segoe UI","Helvetica","Arial","sans-serif","Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";color:#70818a;font-weight:600;text-transform:uppercase;margin-bottom:1rem;text-align:center;} @media (min-width:900px){.gGTliD{margin-bottom:0;}} @media (min-width:900px){.gGTliD{text-align:right;margin-left:auto;}}
/* sc-component-id: PrevNext__Label-fknkt2-3 */
.ezUiIG{font-weight:400;padding-right:1rem;color:#2f392e;} @media (min-width:900px){.ezUiIG{display:block;padding-right:0;}}
/* sc-component-id: AppWrapper__App-sc-1bt277u-0 */
.pRQic{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:100%;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;overflow:hidden;}
/* sc-component-id: Hero__ContentWrapper-sc-14w596v-0 */
.loGAVl{width:100%;position:relative;padding-left:1.5rem;padding-right:1.5rem;background-color:#ffffff;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding-top:1.5rem;padding-bottom:1.5rem;text-align:center;background-color:#f5f6f4;overflow:hidden;padding-top:0;padding-bottom:0;z-index:20;background:linear-gradient(to bottom,#102948 0%,#102031 100%);box-shadow:#0000006e 4px 4px 25px;position:relative;min-height:200px;} @media (min-width:600px){.loGAVl{padding-left:3rem;padding-right:3rem;}} @media (min-width:900px){.loGAVl{padding-left:6rem;padding-right:6rem;}} @media (min-width:1600px){.loGAVl{padding-left:8rem;padding-right:8rem;}} @media (min-width:600px){.loGAVl{padding-top:3rem;padding-bottom:3rem;}} @media (min-width:900px){.loGAVl{text-align:left;}} @media (min-width:600px){.loGAVl{padding-top:2rem;padding-bottom:2rem;}} @media (min-width:900px){.loGAVl{min-height:300px;}}
/* sc-component-id: Hero__InnerWrapper-sc-14w596v-1 */
.duUyde{width:100%;margin-left:auto;margin-right:auto;text-align:center;position:relative;max-width:740px;-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;padding-top:4rem;padding-bottom:4rem;} @media (min-width:900px){.duUyde{text-align:left;}} @media (min-width:900px){.duUyde{padding-top:3rem;padding-bottom:3rem;text-align:center;}} .duUyde > *{opacity:0;}
/* sc-component-id: MarkdownContainer-sc-1s12zg4-0 */
.gtTunZ{width:100%;position:relative;padding-left:1.5rem;padding-right:1.5rem;} @media (min-width:600px){.gtTunZ{padding-left:3rem;padding-right:3rem;}} @media (min-width:900px){.gtTunZ{padding-left:6rem;padding-right:6rem;}} @media (min-width:1600px){.gtTunZ{padding-left:8rem;padding-right:8rem;}} .gtTunZ > div{padding-top:3rem;padding-bottom:3rem;color:#222b2f;font-family:"-apple-system","BlinkMacSystemFont","Segoe UI","Helvetica","Arial","sans-serif","Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";} .gtTunZ > div > *{max-width:740px;margin:0 auto;} .gtTunZ > div h2,.gtTunZ > div h3,.gtTunZ > div h4{font-size:1.125rem;font-family:"-apple-system","BlinkMacSystemFont","Segoe UI","Helvetica","Arial","sans-serif","Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";font-weight:300;color:#2f392e;line-height:2;margin-top:3rem;margin-bottom:3rem;} @media (min-width:900px){.gtTunZ > div h2,.gtTunZ > div h3,.gtTunZ > div h4{font-size:1.5rem;}} .gtTunZ > div h2{font-size:40px;} .gtTunZ > div p,.gtTunZ > div ul,.gtTunZ > div li{font-size:1rem;font-family:"-apple-system","BlinkMacSystemFont","Segoe UI","Helvetica","Arial","sans-serif","Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";color:#2f392e;line-height:2;} @media (min-width:900px){.gtTunZ > div p,.gtTunZ > div ul,.gtTunZ > div li{font-size:1.125rem;}} .gtTunZ > div p,.gtTunZ > div ul{margin-bottom:1.5rem;} .gtTunZ > div h2,.gtTunZ > div h3,.gtTunZ > div h4,.gtTunZ > div p,.gtTunZ > div li{color:#2f392e;text-align:left;} .gtTunZ > div img{max-width:100%;} .gtTunZ > div pre[class*="language-"]{margin-top:0;} @media (min-width:992px){.gtTunZ > div .float-right{width:350px;float:right;margin-right:-120px;margin-left:30px;}} .gtTunZ > div .highlight{display:block;color:#ff2668;margin:40px auto;max-width:450px;font-size:24px;font-style:italic;text-align:center;} @media (min-width:992px){.gtTunZ > div .float-left{width:350px;float:left;margin-right:30px;margin-left:-120px;}} .gtTunZ > div .image-frame{display:block;text-align:center;margin-top:30px;margin-bottom:30px;} .gtTunZ > div .image-frame .image-frame-caption{color:grey;} .gtTunZ > div .gif_player{display:inline-block;position:relative;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-touch-callout:none;-webkit-tap-highlight-color:transparent;cursor:pointer;} .gtTunZ > div .gif_player.playing .play_button{-webkit-transform:translate(-50%,-50%) scale(0) rotate(180deg);-ms-transform:translate(-50%,-50%) scale(0) rotate(180deg);transform:translate(-50%,-50%) scale(0) rotate(180deg);opacity:0.5;} .gtTunZ > div .gif_player img{max-width:100%;} .gtTunZ > div .gif_player:hover .play_button{background-color:rgba(0,0,0,0.7);box-shadow:0 0 0 3px rgba(0,0,0,0.7);} .gtTunZ > div .gif_player .play_button{background-color:rgba(0,0,0,0.5);border-radius:50%;box-shadow:0 0 0 3px rgba(0,0,0,0.5);color:#fff;font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;font-size:48px;text-align:center;vertical-align:text-bottom;line-height:85px;left:50%;opacity:1;padding:1px 0 0px 8px;width:85px;height:85px;position:absolute;top:50%;-webkit-transform:translate(-50%,-50%) scale(1) rotate(0deg);-webkit-transform:translate(-50%,-50%) scale(1) rotate(0deg);-ms-transform:translate(-50%,-50%) scale(1) rotate(0deg);transform:translate(-50%,-50%) scale(1) rotate(0deg);-webkit-transition:opacity 0.4s,-webkit-transform 0.4s;-webkit-transition:opacity 0.4s,-webkit-transform 0.4s;-webkit-transition:opacity 0.4s,-webkit-transform 0.4s;transition:opacity 0.4s,-webkit-transform 0.4s;-webkit-transition:-webkit-transform 0.4s,opacity 0.4s;-webkit-transition:transform 0.4s,opacity 0.4s;transition:transform 0.4s,opacity 0.4s;-webkit-transition:-webkit-transform 0.4s,opacity 0.4s,-webkit-transform 0.4s;-webkit-transition:transform 0.4s,opacity 0.4s,-webkit-transform 0.4s;transition:transform 0.4s,opacity 0.4s,-webkit-transform 0.4s;} .gtTunZ > div .gif_player .play_button::after{content:"▶";} .gtTunZ > div table{border-collapse:collapse;border:1px solid black;margin-top:40px;margin-bottom:40px;} .gtTunZ > div table p{margin-top:0;margin-bottom:0;} .gtTunZ > div table tr:hover{background-color:#efefef;} .gtTunZ > div table th,.gtTunZ > div table td{border-right:1px solid black;border-left:1px solid black;padding:12px;} .gtTunZ > div blockquote{font-size:1rem;font-family:"-apple-system","BlinkMacSystemFont","Segoe UI","Helvetica","Arial","sans-serif","Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";color:#2f392e;line-height:2;margin-bottom:2rem;margin-top:2rem;position:relative;display:block;font-weight:600;text-shadow:0 2px 10px rgba(0,0,0,0.1);padding-left:30px;padding-right:30px;} @media (min-width:900px){.gtTunZ > div blockquote{font-size:1.125rem;}} .gtTunZ > div blockquote p{font-size:20px;font-style:italic;} .gtTunZ > div blockquote .quote-signature{color:grey;display:block;text-align:right;} .gtTunZ > div blockquote .quote-signature::before{content:"— ";} .gtTunZ > div blockquote::before{color:#ff2668;content:"“";position:absolute;font-size:90px;font-family:serif;left:-45px;padding-top:30px;top:15%;line-height:20px;} .gtTunZ > div blockquote::after{color:#ff2668;content:"”";position:absolute;font-size:90px;font-family:serif;right:-40px;top:70%;line-height:20px;} .gtTunZ > div .gatsby-code-title{background-color:#e6e5e3;font-family:Consolas,Monaco,"Andale Mono","Ubuntu Mono",monospace;font-size:1em;text-align:right;padding:10px;}
/* sc-component-id: Blog__PageTitle-sc-1ypd42m-0 */
.gvULkj{font-size:1.875rem;font-family:"EB Garamond","serif";line-height:1.25;color:#2f392e;position:relative;margin:0;padding-top:0.75rem;padding-bottom:0.75rem;text-shadow:-3px -3px 0 rgba(255,255,255,0.82),3px -3px 0 rgba(255,255,255,0.82),-3px 3px 0 rgba(255,255,255,0.82),3px 3px 0 rgba(255,255,255,0.82);color:#f5f6f4;display:inline-block;text-shadow:-3px -3px 0 rgba(0,0,0,0.02),3px -3px 0 rgba(0,0,0,0.02),-3px 3px 0 rgba(0,0,0,0.02),3px 3px 0 rgba(0,0,0,0.02);margin-bottom:0;} @media (min-width:900px){.gvULkj{font-size:3.3rem;}}
/* sc-component-id: Blog__PageSubtitle-sc-1ypd42m-1 */
.kbxvwd{font-size:1rem;font-family:"-apple-system","BlinkMacSystemFont","Segoe UI","Helvetica","Arial","sans-serif","Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";color:#2f392e;line-height:2;color:#ffffff;margin-top:0;} @media (min-width:900px){.kbxvwd{font-size:1.125rem;}} .kbxvwd .Text__Highlight-qowd5r-8{color:inherit;font-weight:bold;}</style><style type="text/css">
    .anchor {
      float: left;
      padding-right: 4px;
      margin-left: -20px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var offset = element.offsetTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="shortcut icon" href="/icons/icon-48x48.png?v=505932b584dcee3d3c6e2ceb36a8c18b"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#FF3D78"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=505932b584dcee3d3c6e2ceb36a8c18b"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=505932b584dcee3d3c6e2ceb36a8c18b"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=505932b584dcee3d3c6e2ceb36a8c18b"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=505932b584dcee3d3c6e2ceb36a8c18b"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=505932b584dcee3d3c6e2ceb36a8c18b"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=505932b584dcee3d3c6e2ceb36a8c18b"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=505932b584dcee3d3c6e2ceb36a8c18b"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=505932b584dcee3d3c6e2ceb36a8c18b"/><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><link as="script" rel="preload" href="/webpack-runtime-a0049e6f58ffa7e6b5ae.js"/><link as="script" rel="preload" href="/app-c24ba271061686e84a52.js"/><link as="script" rel="preload" href="/styles-4e98959b966cf6571aef.js"/><link as="script" rel="preload" href="/commons-dfe77c5a842c6d2906cc.js"/><link as="script" rel="preload" href="/component---src-templates-blog-jsx-8aed05db45fb38b3d384.js"/><link as="fetch" rel="preload" href="/page-data/blog/eks/page-data.json" crossorigin="anonymous"/></head><body><noscript id="gatsby-noscript">This app works best with JavaScript enabled.</noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group" id="gatsby-focus-wrapper"><div class="Navigation__StickyNavShadow-sc-1j36s24-2 bvVRDd"></div><nav style="position:sticky;top:0px" class="Navigation___StyledStickyNav-sc-1j36s24-16 gzanlj"><div open="" class="Content__Container-sc-1g3f5s5-0 Navigation__Nav-sc-1j36s24-3 ilWicQ"><div class="Content__Inner-sc-1g3f5s5-4 Navigation__NavInner-sc-1j36s24-4 dHtnML"><a class="Navigation__NavLink-sc-1j36s24-0 fCaQGl" duration="0.55" hex="#07141d" href="/"><div class="Navigation__LogoWrapper-sc-1j36s24-5 iPnDvY"><svg class="Navigation__Logo-sc-1j36s24-6 fxWQEF" viewBox="0 0 400 110.069"><path fill="currentColor" d="M0 74.07h42v36H0zm42-35h77v32H42zm0-39h77v19H42z"></path><g aria-label="Featurist" font-size="65" font-family="Lato"><path d="M145.228 5.25v16.283h19.142v5.135h-19.142v20.02h-6.305V.115h28.697V5.25zM193.616 26.636q0-2.015-.585-3.673-.553-1.69-1.658-2.893-1.072-1.234-2.632-1.884-1.56-.683-3.543-.683-4.16 0-6.597 2.438-2.405 2.405-2.99 6.695zm4.68 15.437q-1.073 1.3-2.568 2.275-1.495.943-3.217 1.56-1.69.618-3.51.91-1.82.325-3.608.325-3.412 0-6.305-1.137-2.86-1.17-4.972-3.38-2.08-2.243-3.25-5.526-1.17-3.282-1.17-7.54 0-3.445 1.04-6.435 1.072-2.99 3.055-5.167 1.982-2.21 4.842-3.445 2.86-1.268 6.435-1.268 2.958 0 5.46 1.008 2.535.975 4.355 2.86 1.853 1.853 2.893 4.615 1.04 2.73 1.04 6.24 0 1.365-.293 1.82-.292.455-1.105.455h-22.002q.097 3.12.845 5.428.78 2.307 2.145 3.867 1.365 1.528 3.25 2.308 1.885.747 4.225.747 2.177 0 3.737-.487 1.593-.52 2.73-1.105 1.138-.585 1.885-1.073.78-.52 1.333-.52.715 0 1.105.553zM223.7 31.868q-3.997.13-6.824.65-2.795.487-4.583 1.3-1.755.813-2.567 1.917-.78 1.105-.78 2.47 0 1.3.422 2.243.423.942 1.138 1.56.747.585 1.722.877 1.008.26 2.145.26 1.528 0 2.795-.292 1.268-.325 2.373-.91 1.137-.585 2.145-1.397 1.04-.813 2.015-1.853zm-18.687-13.455q2.73-2.633 5.883-3.933 3.152-1.3 6.987-1.3 2.763 0 4.908.91 2.145.91 3.607 2.535 1.463 1.625 2.21 3.933.748 2.307.748 5.07v21.06h-2.568q-.845 0-1.3-.26-.455-.292-.715-1.105l-.65-3.12q-1.3 1.202-2.535 2.145-1.235.91-2.6 1.56-1.365.618-2.925.943-1.527.357-3.412.357-1.918 0-3.608-.52-1.69-.552-2.957-1.625-1.235-1.072-1.983-2.697-.715-1.658-.715-3.9 0-1.95 1.073-3.738 1.072-1.82 3.477-3.217 2.405-1.398 6.273-2.275 3.867-.91 9.49-1.04v-2.568q0-3.835-1.658-5.785-1.657-1.982-4.842-1.982-2.145 0-3.608.552-1.43.52-2.502 1.202-1.04.65-1.82 1.203-.748.52-1.495.52-.585 0-1.008-.292-.422-.325-.715-.78zM247.831 47.208q-3.9 0-6.012-2.178-2.08-2.177-2.08-6.272v-20.15h-3.965q-.52 0-.878-.293-.357-.325-.357-.975v-2.307l5.395-.682 1.332-10.173q.098-.488.423-.78.357-.325.91-.325h2.925v11.342h9.522v4.193h-9.522v19.76q0 2.08 1.007 3.087 1.008 1.008 2.6 1.008.91 0 1.56-.228.683-.26 1.17-.552.488-.292.813-.52.357-.26.617-.26.455 0 .813.552l1.69 2.763q-1.495 1.397-3.608 2.21-2.112.78-4.355.78zM288.155 13.765v32.923h-3.445q-1.235 0-1.56-1.202l-.455-3.543q-2.145 2.373-4.81 3.835-2.665 1.43-6.11 1.43-2.697 0-4.777-.877-2.048-.91-3.445-2.535-1.398-1.625-2.113-3.933-.682-2.307-.682-5.102V13.766h5.785V34.76q0 3.737 1.69 5.785 1.722 2.047 5.232 2.047 2.568 0 4.778-1.202 2.242-1.235 4.127-3.38V13.765zM302.757 20.363q1.56-3.38 3.835-5.265 2.275-1.918 5.558-1.918 1.04 0 1.982.228.975.227 1.723.715l-.423 4.322q-.195.813-.975.813-.455 0-1.332-.195-.878-.195-1.983-.195-1.56 0-2.795.455-1.202.455-2.177 1.365-.943.877-1.723 2.21-.747 1.3-1.365 2.99v20.8h-5.817V13.766h3.315q.942 0 1.3.357.357.358.487 1.235zM326.988 13.765v32.923h-5.785V13.766zm1.235-10.335q0 .845-.358 1.593-.325.715-.91 1.3-.552.552-1.332.877-.748.325-1.593.325t-1.592-.325q-.715-.325-1.268-.877-.552-.585-.877-1.3-.325-.748-.325-1.593t.325-1.592q.325-.78.877-1.333.553-.585 1.268-.91.747-.325 1.592-.325.845 0 1.593.325.78.325 1.332.91.585.553.91 1.333.358.747.358 1.592zM355.668 19.193q-.39.715-1.202.715-.488 0-1.105-.357-.618-.358-1.528-.78-.877-.456-2.112-.813-1.235-.39-2.925-.39-1.463 0-2.633.39-1.17.357-2.015 1.008-.812.65-1.267 1.527-.423.845-.423 1.853 0 1.267.715 2.112.748.845 1.95 1.462 1.203.618 2.73 1.105 1.528.455 3.12 1.008 1.625.52 3.153 1.17 1.527.65 2.73 1.625 1.202.975 1.917 2.405.748 1.397.748 3.38 0 2.275-.813 4.225-.812 1.917-2.405 3.348-1.592 1.397-3.9 2.21-2.307.812-5.33.812-3.445 0-6.24-1.105-2.795-1.137-4.745-2.892l1.365-2.21q.26-.423.618-.65.357-.228.91-.228.585 0 1.235.455.65.455 1.56 1.008.942.552 2.275 1.007 1.332.455 3.315.455 1.69 0 2.957-.422 1.268-.455 2.113-1.203.845-.747 1.235-1.722.422-.975.422-2.08 0-1.365-.747-2.243-.715-.91-1.918-1.527-1.202-.65-2.762-1.105l-3.153-1.008q-1.592-.52-3.152-1.17-1.528-.682-2.73-1.69-1.203-1.007-1.95-2.47-.715-1.495-.715-3.607 0-1.885.78-3.608.78-1.755 2.275-3.055 1.495-1.332 3.672-2.112 2.178-.78 4.973-.78 3.25 0 5.817 1.04 2.6 1.007 4.485 2.795zM374.784 47.208q-3.9 0-6.012-2.178-2.08-2.177-2.08-6.272v-20.15h-3.965q-.52 0-.878-.293-.357-.325-.357-.975v-2.307l5.395-.682 1.332-10.173q.098-.488.423-.78.357-.325.91-.325h2.925v11.342h9.522v4.193h-9.522v19.76q0 2.08 1.007 3.087 1.008 1.008 2.6 1.008.91 0 1.56-.228.683-.26 1.17-.552.488-.292.813-.52.357-.26.617-.26.455 0 .813.552l1.69 2.763q-1.495 1.397-3.608 2.21-2.112.78-4.355.78z"></path></g></svg></div></a><div class="Navigation__TriggerWrapper-sc-1j36s24-11 ojoGc"><div class="Navigation__Trigger-sc-1j36s24-12 bMecYs"><div class="Navigation__HamburgerIcon-sc-1j36s24-7 jDcGGz"><div open="" class="Navigation__LineTop-sc-1j36s24-8 bLfLfh"></div><div open="" class="Navigation__LineMiddle-sc-1j36s24-9 bUVWZV"></div><div open="" class="Navigation__LineBottom-sc-1j36s24-10 dGbbhL"></div></div></div></div><div open="" class="Navigation__ListWrapper-sc-1j36s24-13 gRWWeC"><div class="Navigation__List-sc-1j36s24-14 cLaGLl"><a class="Navigation__NavLink-sc-1j36s24-0 fCaQGl" duration="0.55" hex="#07141d" href="/team"><span class="Navigation__ListItem-sc-1j36s24-15 eFYSEN">Meet the Team</span></a><a class="Navigation__NavLink-sc-1j36s24-0 fCaQGl" duration="0.55" hex="#07141d" href="/case-studies"><span class="Navigation__ListItem-sc-1j36s24-15 ZkiwD">Case Studies</span></a><a class="Navigation__NavLink-sc-1j36s24-0 fCaQGl" duration="0.55" hex="#07141d" href="/blog"><span class="Navigation__ListItem-sc-1j36s24-15 dbapCF">Blog</span></a><a href="/#contact" class="Navigation__HashLink-sc-1j36s24-1 cgkVAB"><span class="Navigation__ListItem-sc-1j36s24-15 ewwFgx">Contact</span></a></div></div></div></div></nav><div class="AppWrapper__App-sc-1bt277u-0 pRQic"><div class="Content__Container-sc-1g3f5s5-0 Content-sc-1g3f5s5-1 main-wrapper Hero__ContentWrapper-sc-14w596v-0 loGAVl" style="z-index:20"><div class="Content__Inner-sc-1g3f5s5-4 text-titles Hero__InnerWrapper-sc-14w596v-1 duUyde"><h1 class="Text__H1-qowd5r-1 Text__H1Light-qowd5r-2 Blog__PageTitle-sc-1ypd42m-0 gvULkj">Using EKS to Deploy all the Pull Requests</h1><p class="Text__P-qowd5r-9 Text__PLight-qowd5r-10 Blog__PageSubtitle-sc-1ypd42m-1 kbxvwd">By <span class="Text__Strong-qowd5r-12 jHKtjg">Tim Macfarlane</span> on<!-- --> <span class="Text__Strong-qowd5r-12 jHKtjg">September 06, 2019</span> • <!-- -->19 min read</p></div></div><div class="Content__Container-sc-1g3f5s5-0 Content-sc-1g3f5s5-1 Content__ContentFull-sc-1g3f5s5-3 gVWHDU"><div class="Content__Container-sc-1g3f5s5-0 MarkdownContainer-sc-1s12zg4-0 gtTunZ"><div><p>This is a pretty technical post! My goal here is to document some of the lesser known aspects of setting up EKS. It’s by no means an introduction to Kubernetes or AWS concepts so I’m presuming some prior experience and knowledge.</p>
<h2 id="deploying-all-the-pull-requests"><a href="#deploying-all-the-pull-requests" aria-label="deploying all the pull requests permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Deploying all the pull requests</h2>
<p>We recently built a system that deployed a brand new, isolated environment for each and every pull request submitted to one of our larger project’s repositories. <a href="https://devcenter.heroku.com/articles/github-integration-review-apps" target="_blank" rel="nofollow">Heroku calls these Review Apps</a>. I talk about the advantages of deploying review apps <a href="/case-studies/ttc-approach-review-apps/">here</a>. The TLDR is that before we had review apps we were releasing every week or two, after we had review apps we were releasing every day or two. It’s all about where you do your manual exploratory testing. Do you do it on the pull-request? Or once your code is in master? It can make a big difference to how often you can release.</p>
<p>Since we were already running our production and test environments in AWS, and since Kubernetes seemed to be a good environment to deploy and run an arbitrary number of different applications, EKS made a lot of sense. EKS is AWS’s manage Kubernetes cluster product.</p>
<h2 id="how-does-this-thing-work"><a href="#how-does-this-thing-work" aria-label="how does this thing work permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>How does this thing work?</h2>
<p>Like many applications, ours is made up of several microservices and third party dependencies such as databases. This is primarily a manual test environment so we throw in a few extra diagnostic tools such as <a href="https://joeferner.github.io/redis-commander/" target="_blank" rel="nofollow">redis-commander</a> to look inside our redis DBs, <a href="https://danfarrelly.nyc/MailDev/" target="_blank" rel="nofollow">maildev</a> to see what emails are being sent by the system and to whom. Because we have several services, it’s not possible to use Heroku’s Review Apps which really only work for single service applications, and, more to the point, with our production system deployed on AWS, it was a good idea to stay on AWS for our test environments.</p>
<p>Each review app has a domain name that includes the PR number and the name of the service. We use a convention such as <code class="language-text">$SERVICE-pr-$PR_NUMBER.example.com</code>, so we’d have domain names such as <code class="language-text">web-pr-1234.example.com</code> and <code class="language-text">api-pr-1234.example.com</code> for the “web” and “api” services respectively, on the pull request with number 1234.</p>
<p>We have a wildcard DNS <code class="language-text">*.example.com</code> pointing at a single load balancer (ELB), which also has a wildcard certificate for the same domain, <code class="language-text">*.example.com</code>. This means all traffic going to those different domains go to the same load balancer. Inside the cluster, we use what is known as an <a href="https://kubernetes.io/docs/concepts/services-networking/ingress-controllers/" target="_blank" rel="nofollow">ingress controller</a> to route the requests to the corresponding service running on the cluster. An ingress controller is usually a load balancer like Nginx that reads the configuration about which host maps to which app from <a href="https://kubernetes.io/docs/concepts/services-networking/ingress/#the-ingress-resource" target="_blank" rel="nofollow">ingress resources</a> you place in the cluster.</p>
<p>Here’s a more or less full breakdown of what happens:</p>
<ol>
<li>We push some code to pull request #1234</li>
<li>Our CI checks out the code and deploys it to our Kubernetes cluster (we used <a href="https://github.com/bitnami/kubecfg" target="_blank" rel="nofollow">kubecfg</a>, helm templates were just too hard to maintain 😭)</li>
<li>Our CI also interacts with the <a href="https://developer.github.com/v3/repos/deployments/" target="_blank" rel="nofollow">GitHub Deployments API</a> so we have nice feedback on the progress of the deployment and finally links to our review app from the pull request page.</li>
</ol>
<p>  <span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:590px">
      <a class="gatsby-resp-image-link" href="/static/1c4f2779ddb8bb821e7ccae495d492fd/9d4f3/deploymentapi.png" style="display:block" target="_blank" rel="noopener">
    <span class="gatsby-resp-image-background-image" style="padding-bottom:20.314735336194563%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAAsSAAALEgHS3X78AAAAoklEQVQI101Oyw6DQAjc///D1vRijFrNPuw+YGFZi+3FyUAIzACmiSDVnEsBAEQNreIfKRFRv0HFpbZSJWOjJoalJUjjOD2ewzC85mXZt239YZomRDxvkH5mUKdEaMRiiFkvJ72swlqJGKgTd+am1JaOsBI3uXh1uCBjvaYGqB45LuvufNA/Na0ObMg+HNYF54/3bj8xqVs36JbNw2yLZiT6AvjP5kVlNj5QAAAAAElFTkSuQmCC&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image" alt="deployment api" title="deployment api" src="/static/1c4f2779ddb8bb821e7ccae495d492fd/b9e4f/deploymentapi.png" srcSet="/static/1c4f2779ddb8bb821e7ccae495d492fd/cf440/deploymentapi.png 148w, /static/1c4f2779ddb8bb821e7ccae495d492fd/d2d38/deploymentapi.png 295w, /static/1c4f2779ddb8bb821e7ccae495d492fd/b9e4f/deploymentapi.png 590w, /static/1c4f2779ddb8bb821e7ccae495d492fd/f9b6a/deploymentapi.png 885w, /static/1c4f2779ddb8bb821e7ccae495d492fd/2d849/deploymentapi.png 1180w, /static/1c4f2779ddb8bb821e7ccae495d492fd/9d4f3/deploymentapi.png 1398w" sizes="(max-width: 590px) 100vw, 590px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy"/>
  </a>
    </span></p>
<ol start="4">
<li>We click on the View Deployment link, or type in an address such as <code class="language-text">web-pr-1234.example.com</code></li>
<li>Our browser resolves the IP address, which points to our ELB</li>
<li>Our browser makes a request to our ELB, with the host header being <code class="language-text">web-pr-1234.example.com</code>.</li>
<li>The ELB forwards that request to the ingress controller inside the Kubernetes cluster (see below), which finds the ingress resource that matches our host header, and forwards the request onto the corresponding kubernetes service, which in turn (!) forwards the request onto one the service’s running pods.</li>
<li>We’re using SSL, so the browser will check that the wild card certificate we used (<code class="language-text">*.example.com</code>) matches the domain entered in the address bar (<code class="language-text">web-pr-1234.example.com</code>).</li>
<li>The browser renders some HTML and we’re good to go.</li>
</ol>
<p>It would have been nicer to have a domain like <code class="language-text">web.pr-1234.example.com</code>, but unfortunately you can only have wild card domains and certificates at one level, such as <code class="language-text">*.example.com</code>, not <code class="language-text">*.*.example.com</code>. It’s possible of course that we could have automated the creation of new certificates and DNS entries for each of our pull requests but this seemed a bit excessive..!</p>
<p>With this basic idea in mind we got to work putting all this together. This article shows some of the working out we did while making the routing and load balancing work, as well as a problem we bumped into as more and more applications were deployed onto the system, the famous max pod limit problem. We do this with commands that you can use to do it yourself.</p>
<h2 id="routing-and-load-balancing"><a href="#routing-and-load-balancing" aria-label="routing and load balancing permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Routing and Load Balancing</h2>
<p>There are three-ish different ways EKS can interact with load balancers on AWS. They differ largely in what or who creates and configures the load balancers: kubernetes or yourself (i.e. with CloudFormation). I’ll go through each option briefly here.</p>
<p>(Dan Maas has written up the first two of these already in his article on <a href="https://medium.com/@dmaas/setting-up-amazon-eks-what-you-must-know-9b9c39627fbc" target="_blank" rel="nofollow">Setting up Amazon EKS</a>)</p>
<ol>
<li>
<p>A LoadBalancer service</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> app<span class="token punctuation">-</span>service
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> LoadBalancer
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> app
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
      <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">80</span></code></pre></div>
<p>Simply creating a Kubernetes service of type LoadBalancer will create a new ELB in the same VPC. The advantage is that it’s a pretty simple way of getting a public address for an app inside the Kubernetes cluster. The disadvantage is that you won’t have much more control over the routing. You can’t, for example, have one ELB routing to multiple backends based on hostname or path.</p>
<p>Another disadvantage here is that while EKS will create the ELB automatically for you, you will likely want to setup a DNS entry for it, HTTPS certificates and perhaps even CloudFront. At which point you’ll be referring back to CloudFormation or manual processes.</p>
<p>You’ll also need to make sure your subnets have the correct tags for this to work, see: <a href="https://docs.aws.amazon.com/eks/latest/userguide/load-balancing.html" target="_blank" rel="nofollow">https://docs.aws.amazon.com/eks/latest/userguide/load-balancing.html</a>.</p>
</li>
<li>
<p>The ALB Ingress Controller</p>
<p>As people are increasingly using the <a href="https://kubernetes.io/docs/concepts/services-networking/ingress/" target="_blank" rel="nofollow">ingress features</a> of Kubernetes over the LoadBalancer service, a native ingress controller for AWS seems to make a lot of sense. Documentation for this can be found here: <a href="https://github.com/kubernetes-sigs/aws-alb-ingress-controller" target="_blank" rel="nofollow">https://github.com/kubernetes-sigs/aws-alb-ingress-controller</a>.</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> extensions/v1beta1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Ingress
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> app
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> app
  <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
    <span class="token key atrule">kubernetes.io/ingress.class</span><span class="token punctuation">:</span> alb
    <span class="token key atrule">alb.ingress.kubernetes.io/scheme</span><span class="token punctuation">:</span> internet<span class="token punctuation">-</span>facing
    <span class="token key atrule">alb.ingress.kubernetes.io/tags</span><span class="token punctuation">:</span> Environment=dev<span class="token punctuation">,</span>Team=test
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">host</span><span class="token punctuation">:</span> app.example.com
      <span class="token key atrule">http</span><span class="token punctuation">:</span>
        <span class="token key atrule">paths</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">path</span><span class="token punctuation">:</span> /
            <span class="token key atrule">backend</span><span class="token punctuation">:</span>
              <span class="token key atrule">serviceName</span><span class="token punctuation">:</span> app<span class="token punctuation">-</span>service
              <span class="token key atrule">servicePort</span><span class="token punctuation">:</span> <span class="token number">80</span></code></pre></div>
<p>The idea here is that a single ingress resource will create an AWS ALB (application load balancer) to give you an public entrypoint, allowing you to do host-based or path-based routing. The slight issue here is that if there are two ingress resources, two ALBs will be created! This is slightly different to the way other ingress controllers work in that there is often just one entrypoint, configured with multiple ingress resources. In short, if you want to manage just one load balancer (with corresponding DNS, certs, etc) for all incoming traffic, your applications will be forced to merge their configuration into a single ingress resource. Which is far from ideal.</p>
<p>Again, like the LoadBalancer service above, the ALB ingress controller will create the ALB automatically for you. It can also setup DNS using Route 53 for you too, see <a href="https://kubernetes-sigs.github.io/aws-alb-ingress-controller/guide/external-dns/setup/" target="_blank" rel="nofollow">here</a>. Setup of other more advanced things like certificates and CloudFront seem to be out of scope so you’ll likely be doing this manually or with CloudFormation templates.</p>
<p>Like the LoadBalancer service above, make sure your subnets have the correct tags for this to work, see: <a href="https://docs.aws.amazon.com/eks/latest/userguide/load-balancing.html" target="_blank" rel="nofollow">https://docs.aws.amazon.com/eks/latest/userguide/load-balancing.html</a>.</p>
</li>
<li>
<p>Regular ELB + NodePort service + Ingress</p>
<p>The third option is much more traditional AWS setup. We have an ELB that points to a number of nodes in the Kubernetes cluster on a particular port (we’re going to use 30080, in the <a href="https://kubernetes.io/docs/concepts/services-networking/service/#nodeport" target="_blank" rel="nofollow">default allowed range</a> of 30000-32767 for a NodePort). We then deploy a regular <a href="https://kubernetes.github.io/ingress-nginx/" target="_blank" rel="nofollow">ingress-nginx</a> setup onto the cluster, but with a service of type NodePort. All traffic will be directed to the ingress-nginx pods which are configured by the one or more ingress resources required by your deployments.</p>
<p><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:590px">
      <a class="gatsby-resp-image-link" href="/static/def93aeb50aa3b45459a0813a7575a4f/d40c8/nodeport.png" style="display:block" target="_blank" rel="noopener">
    <span class="gatsby-resp-image-background-image" style="padding-bottom:62%;position:relative;bottom:0;left:0;display:block"></span>
  <img class="gatsby-resp-image-image" alt="img" title="img" src="/static/def93aeb50aa3b45459a0813a7575a4f/b9e4f/nodeport.png" srcSet="/static/def93aeb50aa3b45459a0813a7575a4f/cf440/nodeport.png 148w, /static/def93aeb50aa3b45459a0813a7575a4f/d2d38/nodeport.png 295w, /static/def93aeb50aa3b45459a0813a7575a4f/b9e4f/nodeport.png 590w, /static/def93aeb50aa3b45459a0813a7575a4f/f9b6a/nodeport.png 885w, /static/def93aeb50aa3b45459a0813a7575a4f/2d849/nodeport.png 1180w, /static/def93aeb50aa3b45459a0813a7575a4f/d40c8/nodeport.png 2000w" sizes="(max-width: 590px) 100vw, 590px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy"/>
  </a>
    </span></p>
<p>The advantage of this approach is that you have a single ELB that you can setup with CloudFormation alongside other elements such as HTTPS certificates, DNS, CloudFront, etc. You could even have two or more ELBs pointing to the same cluster, depending on DNS and certificate requirements.</p>
<p>We’re going to show how you can setup your cluster routing with this last approach.</p>
</li>
</ol>
<h2 id="creating-the-cluster"><a href="#creating-the-cluster" aria-label="creating the cluster permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Creating The Cluster</h2>
<p>As hinted at above, there are indeed plenty of ways you can create an EKS cluster and its surrounding infrastructure. We’re going use <code class="language-text">eksctl</code> to demonstrate in this article, but for production we opted for a single CloudFormation template that setup <em>all</em> the infrastructure (ELBs, HTTPS certificates, CloudFront, DNS, etc) and meant that we could execute the template on each master deployment to keep the infrastructure in line with it’s configuration.</p>
<p><code class="language-text">eksctl</code> is a good tool, but it’s quite <em>imperative</em> whereas for GitOps you really want something that’s <em>declarative</em>. Imperative means you issue individual commands to change the cluster, declarative means you simply change the configuration, execute it, and the system will determine what needs to be changed or updated. CloudFormation and indeed Kubernetes are both great examples of declarative systems. <code class="language-text">eksctl</code> have some <a href="https://eksctl.io/usage/experimental/gitops-flux/" target="_blank" rel="nofollow">GitOps support</a> in the works though, something to wait for.</p>
<p>As we’re using <code class="language-text">eksctl</code>, we’re going to create our cluster in a few steps:</p>
<ol>
<li>Create the VPC, the subnets, and the EKS cluster using <code class="language-text">eksctl</code>.</li>
<li>Create the ELBs and related elements using CloudFormation using outputs from step 1</li>
<li>Finally create the node group using outputs from step 2. A node group is eksctls word for, well, a group of nodes in a cluster, each node having the same instance type and AMI. You can have multiple node groups in a cluster.</li>
</ol>
<p>(Using CloudFormation you can put all this into a single CloudFormation template but that’s probably for another time.)</p>
<p>Anyway, enough chat. Let’s create a cluster:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">eksctl create cluster <span class="token punctuation">\</span>
  --name ReviewApps <span class="token punctuation">\</span>
  --region us-west-2 <span class="token punctuation">\</span>
  --without-nodegroup</code></pre></div>
<p>Behind the scenes <code class="language-text">eksctl</code> will create a CloudFormation stack (called <code class="language-text">eksctl-ReviewApps-cluster</code>) with the elements required to run the EKS cluster, things like the VPC, private and public subnets, internet gateways, etc. We don’t create a node group yet, as we’ll see we need to connect the EC2 instances in the node group to the ELB infrastructure.</p>
<p>Next we’ll create our ELB. Here’s the CloudFormation template:</p>
<div class="gatsby-code-title">elb.yaml</div>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">AWSTemplateFormatVersion</span><span class="token punctuation">:</span> <span class="token string">&#x27;2010-09-09&#x27;</span>
<span class="token key atrule">Description</span><span class="token punctuation">:</span> Review Apps Infrastructure

<span class="token key atrule">Parameters</span><span class="token punctuation">:</span>
  <span class="token key atrule">Vpc</span><span class="token punctuation">:</span>
    <span class="token key atrule">Type</span><span class="token punctuation">:</span> String
    <span class="token key atrule">Description</span><span class="token punctuation">:</span> The VPC to place this ELB into.

  <span class="token key atrule">PublicSubnets</span><span class="token punctuation">:</span>
    <span class="token key atrule">Type</span><span class="token punctuation">:</span> CommaDelimitedList
    <span class="token key atrule">Description</span><span class="token punctuation">:</span> A comma<span class="token punctuation">-</span>delimited list of public subnets in which to run the ELBs

<span class="token key atrule">Resources</span><span class="token punctuation">:</span>
  <span class="token key atrule">WorkerNodeTargetGroup</span><span class="token punctuation">:</span>
    <span class="token key atrule">Type</span><span class="token punctuation">:</span> AWS<span class="token punctuation">:</span><span class="token punctuation">:</span>ElasticLoadBalancingV2<span class="token punctuation">:</span><span class="token punctuation">:</span>TargetGroup
    <span class="token key atrule">Properties</span><span class="token punctuation">:</span>
      <span class="token key atrule">HealthCheckPath</span><span class="token punctuation">:</span> /healthz
      <span class="token key atrule">HealthCheckPort</span><span class="token punctuation">:</span> <span class="token string">&quot;30080&quot;</span>
      <span class="token key atrule">Protocol</span><span class="token punctuation">:</span> HTTP
      <span class="token key atrule">Port</span><span class="token punctuation">:</span> <span class="token number">30080</span>
      <span class="token key atrule">Name</span><span class="token punctuation">:</span>
        <span class="token tag">!Sub</span> <span class="token string">&quot;WorkerTargetGroup&quot;</span>
      <span class="token key atrule">VpcId</span><span class="token punctuation">:</span> <span class="token tag">!Ref</span> Vpc

  <span class="token key atrule">LoadBalancerListenerHttp</span><span class="token punctuation">:</span>
    <span class="token key atrule">Type</span><span class="token punctuation">:</span> AWS<span class="token punctuation">:</span><span class="token punctuation">:</span>ElasticLoadBalancingV2<span class="token punctuation">:</span><span class="token punctuation">:</span>Listener
    <span class="token key atrule">Properties</span><span class="token punctuation">:</span>
      <span class="token key atrule">DefaultActions</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">Type</span><span class="token punctuation">:</span> forward
        <span class="token key atrule">TargetGroupArn</span><span class="token punctuation">:</span>
          <span class="token key atrule">Ref</span><span class="token punctuation">:</span> WorkerNodeTargetGroup
      <span class="token key atrule">LoadBalancerArn</span><span class="token punctuation">:</span>
          <span class="token key atrule">Ref</span><span class="token punctuation">:</span> LoadBalancer
      <span class="token key atrule">Port</span><span class="token punctuation">:</span> <span class="token number">80</span>
      <span class="token key atrule">Protocol</span><span class="token punctuation">:</span> HTTP

  <span class="token key atrule">LoadBalancer</span><span class="token punctuation">:</span>
    <span class="token key atrule">Type</span><span class="token punctuation">:</span> AWS<span class="token punctuation">:</span><span class="token punctuation">:</span>ElasticLoadBalancingV2<span class="token punctuation">:</span><span class="token punctuation">:</span>LoadBalancer
    <span class="token key atrule">Properties</span><span class="token punctuation">:</span>
      <span class="token key atrule">SecurityGroups</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token tag">!Ref</span> ElbSecurityGroup
      <span class="token key atrule">Subnets</span><span class="token punctuation">:</span> <span class="token tag">!Ref</span> PublicSubnets

  <span class="token key atrule">ElbSecurityGroup</span><span class="token punctuation">:</span>
    <span class="token key atrule">Type</span><span class="token punctuation">:</span> AWS<span class="token punctuation">:</span><span class="token punctuation">:</span>EC2<span class="token punctuation">:</span><span class="token punctuation">:</span>SecurityGroup
    <span class="token key atrule">Properties</span><span class="token punctuation">:</span>
      <span class="token key atrule">GroupDescription</span><span class="token punctuation">:</span> Incoming Access To HTTP
      <span class="token key atrule">VpcId</span><span class="token punctuation">:</span> <span class="token tag">!Ref</span> Vpc
      <span class="token key atrule">Tags</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">Key</span><span class="token punctuation">:</span> Name
        <span class="token key atrule">Value</span><span class="token punctuation">:</span>
          <span class="token key atrule">Fn::Join</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token string">&#x27;&#x27;</span>
          <span class="token punctuation">-</span> <span class="token punctuation">-</span> <span class="token key atrule">Ref</span><span class="token punctuation">:</span> AWS<span class="token punctuation">:</span><span class="token punctuation">:</span>StackName
            <span class="token punctuation">-</span> <span class="token string">&quot;ElbSecurityGroup&quot;</span>

  <span class="token key atrule">ElbSecurityGroupEgress</span><span class="token punctuation">:</span>
    <span class="token key atrule">Type</span><span class="token punctuation">:</span> AWS<span class="token punctuation">:</span><span class="token punctuation">:</span>EC2<span class="token punctuation">:</span><span class="token punctuation">:</span>SecurityGroupEgress
    <span class="token key atrule">Properties</span><span class="token punctuation">:</span>
      <span class="token key atrule">GroupId</span><span class="token punctuation">:</span>
        <span class="token key atrule">Ref</span><span class="token punctuation">:</span> ElbSecurityGroup
      <span class="token key atrule">IpProtocol</span><span class="token punctuation">:</span> <span class="token string">&quot;-1&quot;</span>
      <span class="token key atrule">FromPort</span><span class="token punctuation">:</span> <span class="token number">0</span>
      <span class="token key atrule">ToPort</span><span class="token punctuation">:</span> <span class="token number">65535</span>
      <span class="token key atrule">CidrIp</span><span class="token punctuation">:</span> 0.0.0.0/0

  <span class="token key atrule">ElbSecurityGroupIngressHttp</span><span class="token punctuation">:</span>
    <span class="token key atrule">Type</span><span class="token punctuation">:</span> AWS<span class="token punctuation">:</span><span class="token punctuation">:</span>EC2<span class="token punctuation">:</span><span class="token punctuation">:</span>SecurityGroupIngress
    <span class="token key atrule">Properties</span><span class="token punctuation">:</span>
      <span class="token key atrule">GroupId</span><span class="token punctuation">:</span>
        <span class="token key atrule">Ref</span><span class="token punctuation">:</span> ElbSecurityGroup
      <span class="token key atrule">IpProtocol</span><span class="token punctuation">:</span> tcp
      <span class="token key atrule">FromPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
      <span class="token key atrule">ToPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
      <span class="token key atrule">CidrIp</span><span class="token punctuation">:</span> 0.0.0.0/0

  <span class="token key atrule">NodeSecurityGroup</span><span class="token punctuation">:</span>
    <span class="token key atrule">Type</span><span class="token punctuation">:</span> AWS<span class="token punctuation">:</span><span class="token punctuation">:</span>EC2<span class="token punctuation">:</span><span class="token punctuation">:</span>SecurityGroup
    <span class="token key atrule">Properties</span><span class="token punctuation">:</span>
      <span class="token key atrule">GroupDescription</span><span class="token punctuation">:</span> Incoming HTTP for Kubelet
      <span class="token key atrule">VpcId</span><span class="token punctuation">:</span> <span class="token tag">!Ref</span> Vpc
      <span class="token key atrule">Tags</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">Key</span><span class="token punctuation">:</span> Name
        <span class="token key atrule">Value</span><span class="token punctuation">:</span>
          <span class="token key atrule">Fn::Join</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token string">&#x27;&#x27;</span>
          <span class="token punctuation">-</span> <span class="token punctuation">-</span> <span class="token key atrule">Ref</span><span class="token punctuation">:</span> AWS<span class="token punctuation">:</span><span class="token punctuation">:</span>StackName
            <span class="token punctuation">-</span> <span class="token string">&quot;NodeSecurityGroup&quot;</span>

  <span class="token key atrule">NodeSecurityGroupEgress</span><span class="token punctuation">:</span>
    <span class="token key atrule">Type</span><span class="token punctuation">:</span> AWS<span class="token punctuation">:</span><span class="token punctuation">:</span>EC2<span class="token punctuation">:</span><span class="token punctuation">:</span>SecurityGroupEgress
    <span class="token key atrule">Properties</span><span class="token punctuation">:</span>
      <span class="token key atrule">GroupId</span><span class="token punctuation">:</span>
        <span class="token key atrule">Ref</span><span class="token punctuation">:</span> NodeSecurityGroup
      <span class="token key atrule">IpProtocol</span><span class="token punctuation">:</span> <span class="token string">&quot;-1&quot;</span>
      <span class="token key atrule">FromPort</span><span class="token punctuation">:</span> <span class="token number">0</span>
      <span class="token key atrule">ToPort</span><span class="token punctuation">:</span> <span class="token number">65535</span>
      <span class="token key atrule">CidrIp</span><span class="token punctuation">:</span> 0.0.0.0/0

  <span class="token key atrule">NodeSecurityGroupIngressHttp</span><span class="token punctuation">:</span>
    <span class="token key atrule">Type</span><span class="token punctuation">:</span> AWS<span class="token punctuation">:</span><span class="token punctuation">:</span>EC2<span class="token punctuation">:</span><span class="token punctuation">:</span>SecurityGroupIngress
    <span class="token key atrule">Properties</span><span class="token punctuation">:</span>
      <span class="token key atrule">GroupId</span><span class="token punctuation">:</span>
        <span class="token key atrule">Ref</span><span class="token punctuation">:</span> NodeSecurityGroup
      <span class="token key atrule">IpProtocol</span><span class="token punctuation">:</span> tcp
      <span class="token key atrule">FromPort</span><span class="token punctuation">:</span> <span class="token number">30080</span>
      <span class="token key atrule">ToPort</span><span class="token punctuation">:</span> <span class="token number">30080</span>
      <span class="token key atrule">SourceSecurityGroupId</span><span class="token punctuation">:</span> <span class="token tag">!Ref</span> ElbSecurityGroup

<span class="token key atrule">Outputs</span><span class="token punctuation">:</span>

  <span class="token key atrule">NodeSecurityGroup</span><span class="token punctuation">:</span>
    <span class="token key atrule">Description</span><span class="token punctuation">:</span> Node Security Group
    <span class="token key atrule">Value</span><span class="token punctuation">:</span> <span class="token tag">!Ref</span> NodeSecurityGroup

  <span class="token key atrule">ElbDomainName</span><span class="token punctuation">:</span>
    <span class="token key atrule">Description</span><span class="token punctuation">:</span> Load Balancer Domain Name
    <span class="token key atrule">Value</span><span class="token punctuation">:</span> <span class="token tag">!GetAtt</span> LoadBalancer.DNSName

  <span class="token key atrule">WorkerNodeTargetGroup</span><span class="token punctuation">:</span>
    <span class="token key atrule">Description</span><span class="token punctuation">:</span> Worker Node Target Group
    <span class="token key atrule">Value</span><span class="token punctuation">:</span> <span class="token tag">!Ref</span> WorkerNodeTargetGroup</code></pre></div>
<p>We’re going to use a tool called <a href="https://github.com/Nordstrom/cfn" target="_blank" rel="nofollow">cfn</a>, which you can download using Node/NPM: <code class="language-text">npm i -g cfn</code>.</p>
<p>We need to get some outputs from the <code class="language-text">eksctl-ReviewApps-cluster</code> stack, namely <code class="language-text">SubnetsPublic</code> and <code class="language-text">VPC</code>.</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">cfn deploy ReviewAppsLoadBalancer elb.yaml <span class="token punctuation">\</span>
  --Vpc <span class="token variable"><span class="token variable">$(</span>cfn output eksctl-ReviewApps-cluster VPC<span class="token variable">)</span></span> <span class="token punctuation">\</span>
  --PublicSubnets <span class="token variable"><span class="token variable">$(</span>cfn output eksctl-ReviewApps-cluster SubnetsPublic<span class="token variable">)</span></span></code></pre></div>
<p>You can get the outputs of the stack with this:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">eks $ cfn outputs ReviewAppsLoadBalancer <span class="token operator">|</span> json
<span class="token punctuation">{</span>
  <span class="token string">&quot;ElbDomainName&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Revie-LoadB-1FBHYHW4171RT-141325971.us-west-2.elb.amazonaws.com&quot;</span>,
  <span class="token string">&quot;NodeSecurityGroup&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;sg-0e131391e2ef1f980&quot;</span>,
  <span class="token string">&quot;WorkerNodeTargetGroup&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;arn:aws:elasticloadbalancing:us-west-2:596351669136:targetgroup/WorkerTargetGroup/34920be01bd9d6e7&quot;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>From these we get the target group ARNs and the node security group and enter them into this file:</p>
<div class="gatsby-code-title">cluster.yaml</div>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> eksctl.io/v1alpha5
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterConfig

<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> ReviewApps
  <span class="token key atrule">region</span><span class="token punctuation">:</span> us<span class="token punctuation">-</span>west<span class="token punctuation">-</span><span class="token number">2</span>

<span class="token key atrule">nodeGroups</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> ng<span class="token punctuation">-</span><span class="token number">1</span>
    <span class="token key atrule">instanceType</span><span class="token punctuation">:</span> t3.medium
    <span class="token key atrule">desiredCapacity</span><span class="token punctuation">:</span> <span class="token number">3</span>
    <span class="token key atrule">securityGroups</span><span class="token punctuation">:</span>
      <span class="token key atrule">withShared</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
      <span class="token key atrule">withLocal</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
      <span class="token key atrule">attachIDs</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&#x27;...&#x27;</span><span class="token punctuation">]</span> <span class="token comment"># node security group here</span>
    <span class="token key atrule">targetGroupARNs</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&#x27;...&#x27;</span><span class="token punctuation">]</span> <span class="token comment"># target group ARN here</span>
    <span class="token key atrule">maxPodsPerNode</span><span class="token punctuation">:</span> <span class="token number">110</span></code></pre></div>
<p>That last parameter <code class="language-text">maxPodsPerNode</code> we’ll describe in more detail below.</p>
<p>And run</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">eksctl create nodegroup -f cluster.yaml</code></pre></div>
<p>You should see some active nodes in the cluster now:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">eks $ kubectl get nodes
NAME                                           STATUS   ROLES    AGE   VERSION
ip-192-168-14-252.us-west-2.compute.internal   Ready    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>   47s   v1.13.8-eks-cd3eb0
ip-192-168-57-164.us-west-2.compute.internal   Ready    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>   49s   v1.13.8-eks-cd3eb0
ip-192-168-94-132.us-west-2.compute.internal   Ready    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>   51s   v1.13.8-eks-cd3eb0</code></pre></div>
<h2 id="setting-up-ingress--elb"><a href="#setting-up-ingress--elb" aria-label="setting up ingress  elb permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Setting Up Ingress + ELB</h2>
<p>Next we’ll install Ingress-Nginx. We take their “mandatory” resource set from this page: <a href="https://kubernetes.github.io/ingress-nginx/deploy/" target="_blank" rel="nofollow">https://kubernetes.github.io/ingress-nginx/deploy/</a></p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/master/deploy/static/mandatory.yaml</code></pre></div>
<p>Then we’ll make a NodePort service for it so it’s listening on port 30080 on each of our nodes in the cluster:</p>
<div class="gatsby-code-title">ingress-nginx-node-port.yaml</div>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> NodePort
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> http
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
      <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
      <span class="token key atrule">nodePort</span><span class="token punctuation">:</span> <span class="token number">30080</span>
      <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx</code></pre></div>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">kubectl apply -f ingress-nginx-node-port.yaml</code></pre></div>
<p>The ELB can take a little while to mark the instances as healthy again (by default 5 successful checks at 30s each = something like 3 minutes.)</p>
<p>Once they’ve started up, you should be able to check that it’s working. (We get the domain name of the ELB from the CloudFormation outputs above.)</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">eks $ <span class="token function">curl</span> Revie-LoadB-1FBHYHW4171RT-141325971.us-west-2.elb.amazonaws.com/healthz -v
*   Trying <span class="token number">52.43</span>.72.37<span class="token punctuation">..</span>.
* TCP_NODELAY <span class="token builtin class-name">set</span>
* Connected to Revie-LoadB-1FBHYHW4171RT-141325971.us-west-2.elb.amazonaws.com <span class="token punctuation">(</span><span class="token number">52.43</span>.72.37<span class="token punctuation">)</span> port <span class="token number">80</span> <span class="token punctuation">(</span><span class="token comment">#0)</span>
<span class="token operator">&gt;</span> GET /healthz HTTP/1.1
<span class="token operator">&gt;</span> Host: Revie-LoadB-1FBHYHW4171RT-141325971.us-west-2.elb.amazonaws.com
<span class="token operator">&gt;</span> User-Agent: curl/7.54.0
<span class="token operator">&gt;</span> Accept: */*
<span class="token operator">&gt;</span> 
<span class="token operator">&lt;</span> HTTP/1.1 <span class="token number">200</span> OK
<span class="token operator">&lt;</span> Date: Mon, 09 Sep <span class="token number">2019</span> <span class="token number">13</span>:08:45 GMT
<span class="token operator">&lt;</span> Content-Type: text/html
<span class="token operator">&lt;</span> Content-Length: <span class="token number">0</span>
<span class="token operator">&lt;</span> Connection: keep-alive
<span class="token operator">&lt;</span> Server: openresty/1.15.8.1</code></pre></div>
<p>If that’s not working, here are some things you’ll need to check when getting an ELB to talk to nodes in a Kubernetes cluster:</p>
<ul>
<li>Make sure your security groups are setup correctly. The nodes must be able to accept traffic (specifically in our case port 30080 over TCP) from the security group the ELB is running on.</li>
<li>Make sure your nodes are in the subnets included in your Target Group.</li>
<li>Make sure your nodes respond to the health checks configured in the Target Group. Ingress-nginx will respond with a 200 OK to a <code class="language-text">GET /healthz</code>.</li>
</ul>
<p>Now we can start demonstrating some apps running behind our ingress load balancer. Put this into <code class="language-text">backend.yaml</code>:</p>
<div class="gatsby-code-title">backend.yaml</div>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> backend
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">3</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> backend
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> backend
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> backend
        <span class="token key atrule">image</span><span class="token punctuation">:</span> refractalize/proxy<span class="token punctuation">-</span>backend
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> backend
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> backend
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
      <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> extensions/v1beta1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Ingress
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> backend
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">host</span><span class="token punctuation">:</span> app.example.com
    <span class="token key atrule">http</span><span class="token punctuation">:</span>
      <span class="token key atrule">paths</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">path</span><span class="token punctuation">:</span> /
        <span class="token key atrule">backend</span><span class="token punctuation">:</span>
          <span class="token key atrule">serviceName</span><span class="token punctuation">:</span> backend
          <span class="token key atrule">servicePort</span><span class="token punctuation">:</span> <span class="token number">80</span></code></pre></div>
<p>Then:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">kubectl apply -f backend.yaml</code></pre></div>
<p>You should now be seeing this:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">eks $ <span class="token function">curl</span> Revie-LoadB-1FBHYHW4171RT-141325971.us-west-2.elb.amazonaws.com -H <span class="token string">&#x27;Host: app.example.com&#x27;</span>       
<span class="token punctuation">{</span>
  <span class="token string">&quot;host&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;backend-5f99c56b5d-cjx26&quot;</span>,
  <span class="token string">&quot;url&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/&quot;</span>,
  <span class="token string">&quot;method&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;GET&quot;</span>,
  <span class="token string">&quot;headers&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;host&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;app.example.com&quot;</span>,
    <span class="token string">&quot;x-request-id&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;2d5143f6b46c0334447ac6e26d9c8f42&quot;</span>,
    <span class="token string">&quot;x-real-ip&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;10.46.0.0&quot;</span>,
    <span class="token string">&quot;x-forwarded-for&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;10.46.0.0&quot;</span>,
    <span class="token string">&quot;x-forwarded-host&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;app.example.com&quot;</span>,
    <span class="token string">&quot;x-forwarded-port&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;80&quot;</span>,
    <span class="token string">&quot;x-forwarded-proto&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;http&quot;</span>,
    <span class="token string">&quot;x-original-uri&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/&quot;</span>,
    <span class="token string">&quot;x-scheme&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;http&quot;</span>,
    <span class="token string">&quot;x-original-forwarded-for&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;80.245.25.53&quot;</span>,
    <span class="token string">&quot;x-amzn-trace-id&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Root=1-5d76509a-19d0f1249e754dbf9d05751c&quot;</span>,
    <span class="token string">&quot;user-agent&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;curl/7.54.0&quot;</span>,
    <span class="token string">&quot;accept&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;*/*&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Notice how we’re passing <code class="language-text">-H &quot;Host: app.example.com&quot;</code> to <code class="language-text">curl</code>? The routing we setup for the Ingress looks at the <code class="language-text">Host</code> header on the request and directs it to the correct kubernetes service and pods. Remember when you type in “app.example.com” into your browser, the browser does two or three different things with that domain name:</p>
<ol>
<li>It resolves the IP address using DNS</li>
<li>It makes a HTTP request to that IP address with the domain in the host header, e.g. <code class="language-text">Host: app.example.com</code></li>
<li>Finally, in the case of HTTPS, it ensures that the certificate presented in the response matches the hostname entered. The certificate could be a wildcard certificate, in which case it just needs to match app.example.com with *.example.com.</li>
</ol>
<p>Ingress controllers can route based on the path and protocol too.</p>
<h2 id="eks-max-pods"><a href="#eks-max-pods" aria-label="eks max pods permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>EKS Max Pods</h2>
<p>You will likely find that you can only run a limited number of pods on each node in the cluster… This, believe it or not, is a feature.</p>
<p>Let’s scale our backend to some high number, like 70. Across 3 medium nodes this should be quite reasonable.</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">kubectl scale --replicas <span class="token number">70</span> deploy/backend</code></pre></div>
<p>You’ll find that some of our pods aren’t starting, they’re stuck in one of two states <code class="language-text">Pending</code> or <code class="language-text">ContainerCreating</code>. You can see the error in more detail by running <code class="language-text">kubectl describe pod/podname</code>:</p>
<ul>
<li>Those that are <code class="language-text">Pending</code> will have an error message: <code class="language-text">0/3 nodes are available: 3 Insufficient pods, 3 node(s) were unschedulable</code> (this implies that we’re hitting the kubelet’s max pod limit.)</li>
<li>Those that are <code class="language-text">ContainerCreating</code> will have an error message: <code class="language-text">NetworkPlugin cni failed to set up pod &quot;podname&quot; network: add cmd: failed to assign an IP address to container</code> (this implies that we’re running out of available IP addresses on the node, or in the subnet.)</li>
</ul>
<p>This is where the max pods setting comes in. Each kubelet (each node, essentially) has what is known as a pod limit. By default this is 110 pods. In EKS it’s much less because of the default AWS CNI installed on each node. A CNI (or network plugin) tells the kubelet how pods should interact with the network interfaces on the node, and handles things like allocating new IP addresses for your pods.</p>
<p>The difference with the AWS CNI plugin, is that it allocates <em>real</em> IP addresses on the subnet. This makes your pods accessible from outside the cluster, from anywhere inside your VPN - which might sound useful, but actually since there’s no corresponding DNS entries, and since your pods are likely to be recycled with the usual ebb and flow of deployments it’s unlikely many people will want to be connecting directly with your pods, far more likely you’ll be using some form of ingress controller to do this.</p>
<p>Also far more likely is that people wonder why the can only run some limited number of pods on each node. The limit because there’s only a small number of network interfaces available on each EC2 instance. This number depends on the instance type, a full list of these limits can be found <a href="https://github.com/awslabs/amazon-eks-ami/blob/master/files/eni-max-pods.txt" target="_blank" rel="nofollow">here</a>.</p>
<p>To fix all of this, we need to do two things:</p>
<ol>
<li>Replace the default CNI with weave-net.</li>
<li>Reset (or unset) the default pod limit in the kubelets.</li>
</ol>
<p>We’ll start by replacing the CNI, first delete the AWS CNI:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">kubectl delete ds aws-node -n kube-system</code></pre></div>
<p>And install weave-net:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">kubectl apply -f <span class="token string">&quot;https://cloud.weave.works/k8s/net?k8s-version=<span class="token variable"><span class="token variable">$(</span>kubectl version <span class="token operator">|</span> base64 <span class="token operator">|</span> <span class="token function">tr</span> -d <span class="token string">&#x27;<span class="token entity" title="\n">\n</span>&#x27;</span><span class="token variable">)</span></span>&quot;</span></code></pre></div>
<p>We’ve already used the <code class="language-text">maxPodsPerNode</code> setting above on the node group with <code class="language-text">eksctl</code>. If you’re using CloudFormation to create your cluster and nodes, you can add the following user-data to your LaunchConfiguration or LaunchTemplate, it should look something like this:</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">WorkerNodeLaunchConfig</span><span class="token punctuation">:</span>
  <span class="token key atrule">Type</span><span class="token punctuation">:</span> AWS<span class="token punctuation">:</span><span class="token punctuation">:</span>AutoScaling<span class="token punctuation">:</span><span class="token punctuation">:</span>LaunchConfiguration
  <span class="token key atrule">Properties</span><span class="token punctuation">:</span>

    <span class="token punctuation">...</span>

    <span class="token key atrule">UserData</span><span class="token punctuation">:</span>
      <span class="token key atrule">Fn::Base64</span><span class="token punctuation">:</span>
        <span class="token tag">!Sub</span> <span class="token punctuation">|</span><span class="token scalar string">
          #!/bin/bash
          set -o xtrace
          /etc/eks/bootstrap.sh --use-max-pods false ${EksCluster}
          /opt/aws/bin/cfn-signal --exit-code $? \
                   --stack ${AWS::StackName} \
                   --resource NodeGroup  \
                   --region ${AWS::Region}</span></code></pre></div>
<p>Note the <code class="language-text">--use-max-pods</code> argument to the <code class="language-text">bootstrap.sh</code>. By default the bootstrap will start the kubelet with the limit for the instance type, by passing <code class="language-text">--use-max-pods</code> we ignore this limit and use the kubelet’s default limit, which is normally 110 pods per node. More information on how bootstrap.sh works <a href="https://aws.amazon.com/blogs/opensource/improvements-eks-worker-node-provisioning/" target="_blank" rel="nofollow">here</a>, and what cfn-signal is <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/cfn-signal.html" target="_blank" rel="nofollow">here</a>.</p>
<p>You’ll very likely have to reboot all the nodes in the cluster to make both of these changes a reality. The <code class="language-text">eksctl</code> approach for this would be simply to scale the nodes to zero, and back up to original number.</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">eksctl scale nodegroup --name ng-1 --cluster ReviewApps --nodes <span class="token number">0</span>
eksctl scale nodegroup --name ng-2 --cluster ReviewApps --nodes <span class="token number">3</span></code></pre></div>
<p>Now you’re much more likely to be able to use your EC2 instances to their full capacity and save a few dollars in the process.</p>
<h2 id="wrapup"><a href="#wrapup" aria-label="wrapup permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Wrapup</h2>
<p>In summary, there are different ways to setup the EKS cluster, we’ve used <code class="language-text">eksctl</code> here, but CloudFormation is also a great option. We’ve setup a more traditional ELB configuration using a NodePort service for ingress-nginx. Finally, we’ve removed the limit on the number of pods per node imposed by AWS’s default CNI.</p>
<p>It’s always a good idea to get some decent logging and monitoring on your infrastructure too. I won’t go into that here, but we used DataDog on our project and made sure that each of our pods were annotated in such a way that we could easily identify logs coming from a single instance of a system (with mulitple services), a single service (with multiple pods) or indeed just a single pod.</p>
<p>The rest of our work in getting our review apps working involved some automation of build servers, deploying builds on new pushes, and finally cleaning up review apps when the pull requests were closed.</p>
<p>In all, our review apps (and their infrastructure) have been very successful. Our review apps are used by members of our team, of course for manual testing, but also by many of the people and teams we interact with, whether that’s to discuss how features work, for acceptance testing with clients and stake holders or just to see what other team members are up to.</p></div></div></div><div style="background-color:#f5f6f4;padding-left:0;padding-right:0" class="Content__Container-sc-1g3f5s5-0 Content-sc-1g3f5s5-1 Content__ContentFull-sc-1g3f5s5-3 gVWHDU"><div class="Content__Container-sc-1g3f5s5-0 MarkdownContainer-sc-1s12zg4-0 gtTunZ"><div id="disqus_thread"></div></div></div><div style="background-color:#ebede8;padding-left:0;padding-right:0" class="Content__Container-sc-1g3f5s5-0 Content-sc-1g3f5s5-1 Content__ContentFull-sc-1g3f5s5-3 gVWHDU"><div class="Content__Container-sc-1g3f5s5-0 MarkdownContainer-sc-1s12zg4-0 gtTunZ"><div class="PrevNext__Wrapper-fknkt2-0 idWTtV"><div class="PrevNext__Prev-fknkt2-1 bfNQDu"><a style="display:flex;align-items:center;justify-content:center" duration="0.55" hex="#07141d" href="/blog/file-links-in-terminal/"><svg viewBox="0 0 24 24" size="64" style="margin-right:0.5rem" class="CircleIcon__Wrapper-sc-1igkh6j-0 fcEJLH"><circle cx="12" cy="12" r="11" fill="none" stroke="currentColor" stroke-width="0.75" class="CircleIcon__Circle-sc-1igkh6j-1 kkyNDe"></circle><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="0.55"><path d="M15.249 6l-6.498 6.015L15.249 18"></path></g></svg><div><span class="PrevNext__Label-fknkt2-3 ezUiIG">Previous:</span>File Links in the Terminal</div></a></div><div class="PrevNext__Next-fknkt2-2 gGTliD"><a style="display:flex;align-items:center;justify-content:center" duration="0.55" hex="#07141d" href="/blog/react-hooks/"><div><span class="PrevNext__Label-fknkt2-3 ezUiIG">Next:</span>React Hooks I (finally) Understand</div><svg viewBox="0 0 24 24" size="64" style="margin-left:0.5rem" class="CircleIcon__Wrapper-sc-1igkh6j-0 fcEJLH"><circle cx="12" cy="12" r="11" fill="none" stroke="currentColor" stroke-width="0.75" class="CircleIcon__Circle-sc-1igkh6j-1 kkyNDe"></circle><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="0.55"><path d="M8.751 6l6.498 6.015L8.751 18"></path></g></svg></a></div></div></div></div></div><div class="layout__FooterBackground-sc-2sv4ue-0 kNTPos"><div class="Content__Container-sc-1g3f5s5-0 FooterContent__Footer-sc-14lp62o-0 hkWMSW"><div class="Content__Inner-sc-1g3f5s5-4 FooterContent__FooterInner-sc-14lp62o-1 hqzNIg"><div class="FooterContent__Copyright-sc-14lp62o-2 iOqZkn">©<!-- -->2020<!-- --> Featurist Ltd.</div><div class="FooterContent__SocialWrapper-sc-14lp62o-3 iNQBQW"><div class="FooterContent__List-sc-14lp62o-4 iProPY"><a href="https://github.com/featurist" target="_blank" alt="Github @featurist" class="FooterContent__ListItem-sc-14lp62o-5 emjNbC"><svg viewBox="0 0 24 24" size="42" class="CircleIcon__Wrapper-sc-1igkh6j-0 bLYTqr"><circle cx="12" cy="12" r="11" fill="none" stroke="currentColor" stroke-width="0.75" class="CircleIcon__Circle-sc-1igkh6j-1 kkyNDe"></circle><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="0.55"><path d="M12 3.883a8.02 8.02 0 0 0-2.535 15.628c.401.074.53-.174.53-.385v-1.493c-2.23.485-2.695-.947-2.695-.947-.365-.926-.891-1.173-.891-1.173-.727-.498.056-.487.056-.487.805.056 1.229.826 1.229.826.715 1.226 1.876.872 2.333.667.072-.518.28-.872.51-1.072-1.781-.204-3.654-.892-3.654-3.963 0-.877.314-1.592.826-2.153-.083-.202-.357-1.018.078-2.122 0 0 .674-.215 2.206.822A7.668 7.668 0 0 1 12 7.761a7.69 7.69 0 0 1 2.009.27c1.531-1.037 2.203-.822 2.203-.822.436 1.104.162 1.92.079 2.122.514.561.825 1.277.825 2.153 0 3.079-1.876 3.758-3.661 3.956.287.249.55.737.55 1.485v2.201c0 .213.128.463.535.384A8.02 8.02 0 0 0 12 3.883z"></path></g></svg></a><a href="https://twitter.com/featurists" target="_blank" alt="Twitter @featurists" class="FooterContent__ListItem-sc-14lp62o-5 emjNbC"><svg viewBox="0 0 24 24" size="42" class="CircleIcon__Wrapper-sc-1igkh6j-0 bLYTqr"><circle cx="12" cy="12" r="11" fill="none" stroke="currentColor" stroke-width="0.75" class="CircleIcon__Circle-sc-1igkh6j-1 kkyNDe"></circle><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="0.55"><path d="M18.505 7.965a5.29 5.29 0 0 1-1.533.42 2.67 2.67 0 0 0 1.174-1.477 5.352 5.352 0 0 1-1.695.648 2.672 2.672 0 0 0-4.549 2.434A7.578 7.578 0 0 1 6.4 7.202a2.674 2.674 0 0 0 .826 3.564 2.654 2.654 0 0 1-1.208-.334c-.03 1.236.857 2.393 2.141 2.651a2.68 2.68 0 0 1-1.206.045 2.671 2.671 0 0 0 2.494 1.854 5.367 5.367 0 0 1-3.952 1.106 7.556 7.556 0 0 0 4.091 1.199c4.957 0 7.757-4.186 7.587-7.94a5.418 5.418 0 0 0 1.332-1.382z"></path></g></svg></a></div></div></div></div></div></div></div><script>
  
  function gaOptout(){document.cookie=disableStr+'=true; expires=Thu, 31 Dec 2099 23:59:59 UTC;path=/',window[disableStr]=!0}var gaProperty='UA-34932868-1',disableStr='ga-disable-'+gaProperty;document.cookie.indexOf(disableStr+'=true')>-1&&(window[disableStr]=!0);
  if(!(parseInt(navigator.doNotTrack) === 1 || parseInt(window.doNotTrack) === 1 || parseInt(navigator.msDoNotTrack) === 1 || navigator.doNotTrack === "yes")) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-34932868-1', 'auto', {"sampleRate":5,"siteSpeedSampleRate":10});
      ga('set', 'anonymizeIp', true);
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/eks/";window.webpackCompilationHash="7edc2138b29364a65947";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-c24ba271061686e84a52.js"],"component---src-templates-case-study-jsx":["/component---src-templates-case-study-jsx-15f9b2b237cf75fafdcc.js"],"component---src-templates-blog-jsx":["/component---src-templates-blog-jsx-8aed05db45fb38b3d384.js"],"component---src-pages-404-jsx":["/component---src-pages-404-jsx-bdbc56a8b95e5fbff8bd.js"],"component---src-pages-blog-jsx":["/component---src-pages-blog-jsx-5579c69c2911c0ce2159.js"],"component---src-pages-careers-jsx":["/component---src-pages-careers-jsx-ae73998de53e9bce91d8.js"],"component---src-pages-case-studies-jsx":["/component---src-pages-case-studies-jsx-e835258406630f0613be.js"],"component---src-pages-index-jsx":["/component---src-pages-index-jsx-d1717a673b319bc38e5c.js"],"component---src-pages-team-jsx":["/component---src-pages-team-jsx-fb867ea59460222581ac.js"]};/*]]>*/</script><script src="/component---src-templates-blog-jsx-8aed05db45fb38b3d384.js" async=""></script><script src="/commons-dfe77c5a842c6d2906cc.js" async=""></script><script src="/styles-4e98959b966cf6571aef.js" async=""></script><script src="/app-c24ba271061686e84a52.js" async=""></script><script src="/webpack-runtime-a0049e6f58ffa7e6b5ae.js" async=""></script></body></html>
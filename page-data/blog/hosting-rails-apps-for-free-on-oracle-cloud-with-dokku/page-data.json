{"componentChunkName":"component---src-templates-blog-jsx","path":"/blog/hosting-rails-apps-for-free-on-oracle-cloud-with-dokku/","result":{"data":{"markdownRemark":{"html":"<p>We all know and love “git push” deploys popularized by <a href=\"https://heroku.com\" target=\"_blank\" rel=\"nofollow\">Heroku</a> some eons ego. Heroku also got us spoiled with a great CLI. But hosting on Heroku (or similar services) costs money. Which is fine for serious stuff, but sometimes you just want to host a side project where the only acceptable price is zero.</p>\n<p>In this post we’ll setup a self-hosted Heroku like expirience on a free<a href=\"#caveat\"><sup>1</sup></a> cloud vm. Using a Heroku like CLI, we will then deploy a Rails app featuring:</p>\n<ul>\n<li>Postgres database</li>\n<li>worker</li>\n<li>custom domain</li>\n<li>TLS certificate from Letsencrypt (with auto renewals)</li>\n<li>periodic database backups to AWS S3</li>\n<li>logging to external service (a la heroku log drains)</li>\n</ul>\n<h2 id=\"free-hardware\" style=\"position:relative;\"><a href=\"#free-hardware\" aria-label=\"free hardware permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Free hardware</h2>\n<p>I recently learned about Oracle Cloud <a href=\"https://www.oracle.com/cloud/free/\" target=\"_blank\" rel=\"nofollow\">always free</a> offer, so there’s our free server.</p>\n<p>A free instance gets up to 3 OCPU cores (whataver that means), 6GB of RAM, 46GB of block storage and 10TB of outbound traffic. Pretty good. It’s worth pointing out that those riches are only available for Oracle Ampere Arm CPUs. This will present some challanges, but nothing unavoidable - all necessary workarounds are covered in the post.</p>\n<p>For the purpose of this post I opted for Ubuntu image (simply because I am more familiar with it). The experience on the default Oracle Linux may or may not vary.</p>\n<p>Once the vm is up, make sure passwordless ssh is configured (this is done either when an instance is created or later with <code class=\"language-text\">ssh-copy-id</code>). Login to the instance and make sure packages are up to date:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">sudo apt get update &amp;&amp; sudo apt get upgrade</code></pre></div>\n<p>After the that’s done, we need to open http ports 443 and 80. This is done by adding an Ingress Rule in Security List of your instance’s Virtual Cloud Network (see details in the official <a href=\"https://docs.oracle.com/en-us/iaas/developer-tutorials/tutorials/apache-on-ubuntu/01oci-ubuntu-apache-summary.htm\" target=\"_blank\" rel=\"nofollow\">guide</a>).</p>\n<blockquote>\n<p>For some reason the above didn’t actually open the ports, but the following extra steps did the trick:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">sudo apt install firewalld\nsudo firewall-cmd --zone=public --permanent --add-port=80/tcp\nsudo firewall-cmd --zone=public --permanent --add-port=443/tcp\nsudo firewall-cmd --reload</code></pre></div>\n</blockquote>\n<h2 id=\"dokku\" style=\"position:relative;\"><a href=\"#dokku\" aria-label=\"dokku permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Dokku</h2>\n<p>Heroku experience is provided by <a href=\"https://dokku.com/\" target=\"_blank\" rel=\"nofollow\">Dokku</a> - a self hosted PAAS. Dokku is a popular, mature project that is capable of more than just hosting pet projects. Having said that, Dokku runs on a single server, so there’s a natural limit to where it’s applicable.</p>\n<h3 id=\"install-dokku\" style=\"position:relative;\"><a href=\"#install-dokku\" aria-label=\"install dokku permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Install Dokku</h3>\n<p>Follow Dokku <a href=\"https://dokku.com/docs/getting-started/installation/#1-install-dokku\" target=\"_blank\" rel=\"nofollow\">install guide</a>.</p>\n<blockquote>\n<p>Don’t use <code class=\"language-text\">sslip.io</code> in <code class=\"language-text\">dokku domains:set-global</code> because letsencrypt doesn’t seem to be working for <code class=\"language-text\">sslip.io</code> based vhosts (at the time of this writing). Either use your own domain if you have a spare one, or simply skip <code class=\"language-text\">set-global</code> part altogether. This way you won’t have automatic virtual hostnames (e.g. <code class=\"language-text\">your-app-name.your-vhost.com</code>), but that’s not a show stopper and it can be enabled later at any point.</p>\n</blockquote>\n<p>To be able to run Dokku commands from local machine, install a Dokku <a href=\"https://dokku.com/docs/deployment/remote-commands/#official-client\" target=\"_blank\" rel=\"nofollow\">client</a>:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">brew install dokku/repo/dokku</code></pre></div>\n<p>Then export <code class=\"language-text\">DOKKU_HOST</code> environment variable pointing to the server public IP.</p>\n<p>Run some Dokku command to make sure it works:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">❯ dokku apps:list\n=====> My Apps\n !     You haven't deployed any applications yet</code></pre></div>\n<h3 id=\"deploying-to-dokku\" style=\"position:relative;\"><a href=\"#deploying-to-dokku\" aria-label=\"deploying to dokku permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Deploying to Dokku</h3>\n<p>Your Rails app is likely to require Postgres, so we need to add a postgres <em>plugin</em> to Dokku. This is done with the following command on the Dokku host:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">sudo dokku plugin:install https://github.com/dokku/dokku-postgres.git</code></pre></div>\n<p>Now back to your local machine, let’s create the app. In the app folder:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">dokku apps:create rails-testing-post</code></pre></div>\n<p>For the database, we need to create a <em>service</em> an attach it to our app:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">dokku postgres:create railsdatabase</code></pre></div>\n<blockquote>\n<p>This however fails on Ampere CPU with the following error:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">❯ dokku postgres:create railsdatabase\n       Waiting for container to be ready\nWARNING: The requested image's platform (linux/amd64) does not match the detected host platform (linux/arm64/v8) and no specific platform was requested\nstandard_init_linux.go:228: exec user process caused: exec format error</code></pre></div>\n<p>A cursory glance on the Internet revealed a <a href=\"https://www.reddit.com/r/docker/comments/ray2wc/comment/hnluex8/?utm_source=share&#x26;utm_medium=web2x&#x26;context=3\" target=\"_blank\" rel=\"nofollow\">workaround</a> (run this on the dokku host):</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">sudo docker run --privileged --rm tonistiigi/binfmt --install all</code></pre></div>\n<p>Note: this needs to be run every time the host machine reboots.</p>\n<p>Now repeat the <code class=\"language-text\">dokku postgres:create</code> and it is going to succeed. Note, that using <code class=\"language-text\">binfmt</code> might incur a performance hit on some tasks.</p>\n</blockquote>\n<p>Link Postgres service to the app:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">dokku postgres:link railsdatabase</code></pre></div>\n<p>At this point, we are ready to <code class=\"language-text\">git push dokku master</code>.</p>\n<p>However that’s failing due to Dokku version of Node (my test Rails app happens to require Node for Webpacker) being incompatible with the Ampere CPU architecture. We can workaround that by using <code class=\"language-text\">Dockerfile</code> deployment. This isn’t the only alternative - see <a href=\"https://dokku.com/docs/deployment/builders/cloud-native-buildpacks/\" target=\"_blank\" rel=\"nofollow\">cloud native buildpacks</a> - but that’s the one that worked for me.</p>\n<h4 id=\"docker-image-deploy\" style=\"position:relative;\"><a href=\"#docker-image-deploy\" aria-label=\"docker image deploy permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Docker image deploy</h4>\n<p>Another reason to consider Dockerfile deploy is that it’s faster. For one, Docker cache skips <code class=\"language-text\">bundle install</code> which takes an awful lot longer on a cloud VM, than locally.</p>\n<p>By default Dokku attempts to autodetect the type of your app (e.g. Rails, Node). If, however, it encounters a <code class=\"language-text\">Dockerfile</code>, it simply builds an image and then runs a container. This requires a couple of extra files in our project.</p>\n<p><code class=\"language-text\">app.json</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Rails testing post\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"dokku\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"predeploy\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"bundle exec rails webpacker:compile\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"postdeploy\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"bundle exec rails db:migrate\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">Dockerfile</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre class=\"language-dockerfile\"><code class=\"language-dockerfile\"><span class=\"token instruction\"><span class=\"token keyword\">FROM</span> ruby:2.7.5</span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">RUN</span> curl -fsSL https://deb.nodesource.com/setup_16.x | bash -</span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">RUN</span> apt-get update -qq &amp;&amp; apt-get install -y nodejs</span>\n<span class=\"token instruction\"><span class=\"token keyword\">RUN</span> npm install -g yarn</span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">WORKDIR</span> /app</span>\n<span class=\"token instruction\"><span class=\"token keyword\">ENV</span> RAILS_ENV=production</span>\n<span class=\"token instruction\"><span class=\"token keyword\">ENV</span> PORT=3000</span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">ADD</span> Gemfile* /app/</span>\n<span class=\"token instruction\"><span class=\"token keyword\">RUN</span> bundle install</span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">ADD</span> package.json yarn.lock /app/</span>\n<span class=\"token instruction\"><span class=\"token keyword\">RUN</span> yarn install</span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">ADD</span> . /app/</span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">CMD</span> bundle exec rails server</span></code></pre></div>\n<p>Now we can deploy the app:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">git push dokku master</code></pre></div>\n<p>The web process might crash because it can’t get <code class=\"language-text\">secret_key_base</code> from encrypted credentials. Just like on Heroku, we can use the CLI to set the necessary environment variable:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">dokku config:set RAILS_MASTER_KEY=$(cat config/master.key)</code></pre></div>\n<p>Congrats, you’re up! But, unless you set up vhosts, the app is not yet accessible from the Internet.</p>\n<h3 id=\"adding-domain\" style=\"position:relative;\"><a href=\"#adding-domain\" aria-label=\"adding domain permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Adding domain</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">dokku domains:add your-domain.dev</code></pre></div>\n<p>You need to add an <code class=\"language-text\">A</code> record for your domain that points to the public IP address of your server (or to the vhost, if you created one).</p>\n<h3 id=\"setting-up-tls\" style=\"position:relative;\"><a href=\"#setting-up-tls\" aria-label=\"setting up tls permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Setting up TLS</h3>\n<p>Dokku provides a Letsencrypt <a href=\"https://github.com/dokku/dokku-letsencrypt\" target=\"_blank\" rel=\"nofollow\">plugin</a></p>\n<p>Install it on the host:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">sudo dokku plugin:install https://github.com/dokku/dokku-letsencrypt.git</code></pre></div>\n<p>Then locally:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">dokku config:set --no-restart DOKKU_LETSENCRYPT_EMAIL=your@email.dev\ndokku letsencrypt:enable</code></pre></div>\n<p>To enable auto-renew (optional):</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">dokku letsencrypt:cron-job --add</code></pre></div>\n<h3 id=\"serve-assets-from-rails\" style=\"position:relative;\"><a href=\"#serve-assets-from-rails\" aria-label=\"serve assets from rails permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Serve assets from rails</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">dokku config:set RAILS_SERVE_STATIC_FILES=1</code></pre></div>\n<h3 id=\"console-logs\" style=\"position:relative;\"><a href=\"#console-logs\" aria-label=\"console logs permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Console logs</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">dokku config:set RAILS_LOG_TO_STDOUT=true</code></pre></div>\n<h3 id=\"papertrail-logs\" style=\"position:relative;\"><a href=\"#papertrail-logs\" aria-label=\"papertrail logs permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Papertrail logs</h3>\n<p><a href=\"https://www.papertrail.com/\" target=\"_blank\" rel=\"nofollow\">Papertrail</a> is a good logging service with a free tier. Create a log destination and use it as an endpoint in the following command:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">dokku logs:set vector-sink \"papertrail://?endpoint=logs.papertrailapp.com:11111&amp;encoding=text\"</code></pre></div>\n<blockquote>\n<p>If this fails for whatever reason it does so silently. You can view vector logs to make sure the above command actually succeeded:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">dokku logs:vector-logs</code></pre></div>\n</blockquote>\n<h3 id=\"postgres-backups\" style=\"position:relative;\"><a href=\"#postgres-backups\" aria-label=\"postgres backups permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Postgres backups</h3>\n<p>Dokku Postgres let’s you backup to AWS S3.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">dokku postgres:backup-auth railsdatabase $AWS_ACCESS_KEY_ID $AWS_SECRET_ACCESS_KEY</code></pre></div>\n<p>Create S3 bucket <code class=\"language-text\">railsdatabase-backup</code>. Then for one off backup:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">dokku postgres:backup railsdatabase railsdatabase-backup</code></pre></div>\n<p>And to setup periodic backups:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">dokku postgres:backup-schedule railsdatabase \"0 3 * * *\" railsdatabase_backup</code></pre></div>\n<blockquote>\n<p>This might give you the following error:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">!     Invalid flag provided, only '--use-iam' allowed</code></pre></div>\n<p>This is a very confusing message because it’s got nothing to do with the flags and everything to do with the fact that “0 3 * * *” is being expanded on its way over ssh. Or something along those lines. Anyway, you can run the same command on the remote host without an issue:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">sudo dokku postgres:backup-schedule railsdatabase \"0 3 * * *\" railsdatabase_backup</code></pre></div>\n</blockquote>\n<h3 id=\"worker\" style=\"position:relative;\"><a href=\"#worker\" aria-label=\"worker permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Worker</h3>\n<p>In order to have more than just one web process, we need to add a <code class=\"language-text\">Procfile</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">web: bundle exec rails server -p $PORT\nworker: bundle exec rails runner 'sleep 1 while true' # dummy example</code></pre></div>\n<p>By default Dokku only scales <code class=\"language-text\">web</code> process to 1, so we need to turn on the worker after deploy:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">dokku ps:scale worker=1</code></pre></div>\n<p>Now we can see that it’s up:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">❯ dokku ps:report\n=====> rails-testing-post ps information\n       Deployed:                      true\n       Processes:                     2\n       Ps can scale:                  true\n       Ps computed procfile path:     Procfile\n       Ps global procfile path:       Procfile\n       Ps procfile path:\n       Ps restart policy:             on-failure:10\n       Restore:                       true\n       Running:                       true\n       Status web 1:                  running (CID: ce5a22a9afe)\n       Status worker 1:               running (CID: e6ab6bac412)</code></pre></div>\n<h3 id=\"continuous-deploy-from-github\" style=\"position:relative;\"><a href=\"#continuous-deploy-from-github\" aria-label=\"continuous deploy from github permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Continuous deploy from Github</h3>\n<p>Use Dokku <a href=\"https://github.com/marketplace/actions/dokku\" target=\"_blank\" rel=\"nofollow\">Github action</a> to automatically deploy on push to Github.</p>\n<h2 id=\"useful-free-services\" style=\"position:relative;\"><a href=\"#useful-free-services\" aria-label=\"useful free services permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Useful free services</h2>\n<p>This is by no means an exhaustive list, but I’ve used these ones and they are good.</p>\n<ul>\n<li><a href=\"https://www.skylight.io/\" target=\"_blank\" rel=\"nofollow\">Skylight</a> for APM</li>\n<li><a href=\"https://rollbar.com\" target=\"_blank\" rel=\"nofollow\">Rollbar</a> for error notification</li>\n<li><a href=\"https://uptimerobot.com\" target=\"_blank\" rel=\"nofollow\">Uptimerobot</a> for uptime monitoring</li>\n<li><a href=\"https://sendgrid.com/\" target=\"_blank\" rel=\"nofollow\">Sendgrid</a> for sending emails</li>\n</ul>\n<h2 id=\"caveat\" style=\"position:relative;\"><a href=\"#caveat\" aria-label=\"caveat permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Caveat</h2>\n<p>There are no free lunches. There are no free servers either. Yes, you can create an Oracle VM for free at (almost) any point, but, as it turned out, it can just as easily vanish at any point. My particular experience was during a week (!) long service disruption when the server got shut down and I wasn’t able to create another one. And then I found out that this happens <a href=\"https://www.reddit.com/r/oraclecloud/comments/pcfvz4/solution_unable_to_start_instance_instance_is/\" target=\"_blank\" rel=\"nofollow\">all the time</a>. I am guessing killing free servers is their coping strategy for when things start falling apart. It’s probably mentioned somewhere deep in the TOS, but I couldn’t find it. I hope Oracle will pull their stuff together (or at least make this very clear upfront). In the meantime, be warned.</p>\n<p>But, perhaps, some things are worth paying for after all. I’ve been using <a href=\"https://contabo.com/en/\" target=\"_blank\" rel=\"nofollow\">Contabo</a> for a couple of years now and I have NEVER had any issues. For a 5€/month I get a server with enough RAM/CPU/storage/bandwidth to comfortably host a slew of pet projects as well as two Minecraft servers. And no Ampere workarounds required.</p>\n<hr>\n<p>There is a Reddit <a href=\"https://www.reddit.com/r/rails/comments/uei7gn/hosting_rails_apps_for_free_on_oracle_cloud_with/\" target=\"_blank\" rel=\"nofollow\">discussion</a> of this post.</p>","htmlAst":{"type":"root","children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"We all know and love “git push” deploys popularized by "},{"type":"element","tagName":"a","properties":{"href":"https://heroku.com","target":"_blank","rel":["nofollow"]},"children":[{"type":"text","value":"Heroku"}]},{"type":"text","value":" some eons ego. Heroku also got us spoiled with a great CLI. But hosting on Heroku (or similar services) costs money. Which is fine for serious stuff, but sometimes you just want to host a side project where the only acceptable price is zero."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In this post we’ll setup a self-hosted Heroku like expirience on a free"},{"type":"element","tagName":"a","properties":{"href":"#caveat"},"children":[{"type":"element","tagName":"sup","properties":{},"children":[{"type":"text","value":"1"}]}]},{"type":"text","value":" cloud vm. Using a Heroku like CLI, we will then deploy a Rails app featuring:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Postgres database"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"worker"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"custom domain"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"TLS certificate from Letsencrypt (with auto renewals)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"periodic database backups to AWS S3"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"logging to external service (a la heroku log drains)"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"free-hardware","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#free-hardware","ariaLabel":"free hardware permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Free hardware"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"I recently learned about Oracle Cloud "},{"type":"element","tagName":"a","properties":{"href":"https://www.oracle.com/cloud/free/","target":"_blank","rel":["nofollow"]},"children":[{"type":"text","value":"always free"}]},{"type":"text","value":" offer, so there’s our free server."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"A free instance gets up to 3 OCPU cores (whataver that means), 6GB of RAM, 46GB of block storage and 10TB of outbound traffic. Pretty good. It’s worth pointing out that those riches are only available for Oracle Ampere Arm CPUs. This will present some challanges, but nothing unavoidable - all necessary workarounds are covered in the post."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"For the purpose of this post I opted for Ubuntu image (simply because I am more familiar with it). The experience on the default Oracle Linux may or may not vary."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Once the vm is up, make sure passwordless ssh is configured (this is done either when an instance is created or later with "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"ssh-copy-id"}]},{"type":"text","value":"). Login to the instance and make sure packages are up to date:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"sudo apt get update && sudo apt get upgrade"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"After the that’s done, we need to open http ports 443 and 80. This is done by adding an Ingress Rule in Security List of your instance’s Virtual Cloud Network (see details in the official "},{"type":"element","tagName":"a","properties":{"href":"https://docs.oracle.com/en-us/iaas/developer-tutorials/tutorials/apache-on-ubuntu/01oci-ubuntu-apache-summary.htm","target":"_blank","rel":["nofollow"]},"children":[{"type":"text","value":"guide"}]},{"type":"text","value":")."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"For some reason the above didn’t actually open the ports, but the following extra steps did the trick:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"sudo apt install firewalld\nsudo firewall-cmd --zone=public --permanent --add-port=80/tcp\nsudo firewall-cmd --zone=public --permanent --add-port=443/tcp\nsudo firewall-cmd --reload"}]}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"dokku","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#dokku","ariaLabel":"dokku permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Dokku"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Heroku experience is provided by "},{"type":"element","tagName":"a","properties":{"href":"https://dokku.com/","target":"_blank","rel":["nofollow"]},"children":[{"type":"text","value":"Dokku"}]},{"type":"text","value":" - a self hosted PAAS. Dokku is a popular, mature project that is capable of more than just hosting pet projects. Having said that, Dokku runs on a single server, so there’s a natural limit to where it’s applicable."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"install-dokku","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#install-dokku","ariaLabel":"install dokku permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Install Dokku"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Follow Dokku "},{"type":"element","tagName":"a","properties":{"href":"https://dokku.com/docs/getting-started/installation/#1-install-dokku","target":"_blank","rel":["nofollow"]},"children":[{"type":"text","value":"install guide"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Don’t use "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"sslip.io"}]},{"type":"text","value":" in "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"dokku domains:set-global"}]},{"type":"text","value":" because letsencrypt doesn’t seem to be working for "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"sslip.io"}]},{"type":"text","value":" based vhosts (at the time of this writing). Either use your own domain if you have a spare one, or simply skip "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"set-global"}]},{"type":"text","value":" part altogether. This way you won’t have automatic virtual hostnames (e.g. "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"your-app-name.your-vhost.com"}]},{"type":"text","value":"), but that’s not a show stopper and it can be enabled later at any point."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"To be able to run Dokku commands from local machine, install a Dokku "},{"type":"element","tagName":"a","properties":{"href":"https://dokku.com/docs/deployment/remote-commands/#official-client","target":"_blank","rel":["nofollow"]},"children":[{"type":"text","value":"client"}]},{"type":"text","value":":"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"brew install dokku/repo/dokku"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Then export "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"DOKKU_HOST"}]},{"type":"text","value":" environment variable pointing to the server public IP."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Run some Dokku command to make sure it works:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"❯ dokku apps:list\n=====> My Apps\n !     You haven't deployed any applications yet"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"deploying-to-dokku","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#deploying-to-dokku","ariaLabel":"deploying to dokku permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Deploying to Dokku"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Your Rails app is likely to require Postgres, so we need to add a postgres "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"plugin"}]},{"type":"text","value":" to Dokku. This is done with the following command on the Dokku host:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"sudo dokku plugin:install https://github.com/dokku/dokku-postgres.git"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Now back to your local machine, let’s create the app. In the app folder:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"dokku apps:create rails-testing-post"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"For the database, we need to create a "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"service"}]},{"type":"text","value":" an attach it to our app:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"dokku postgres:create railsdatabase"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"This however fails on Ampere CPU with the following error:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"❯ dokku postgres:create railsdatabase\n       Waiting for container to be ready\nWARNING: The requested image's platform (linux/amd64) does not match the detected host platform (linux/arm64/v8) and no specific platform was requested\nstandard_init_linux.go:228: exec user process caused: exec format error"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"A cursory glance on the Internet revealed a "},{"type":"element","tagName":"a","properties":{"href":"https://www.reddit.com/r/docker/comments/ray2wc/comment/hnluex8/?utm_source=share&utm_medium=web2x&context=3","target":"_blank","rel":["nofollow"]},"children":[{"type":"text","value":"workaround"}]},{"type":"text","value":" (run this on the dokku host):"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"sudo docker run --privileged --rm tonistiigi/binfmt --install all"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Note: this needs to be run every time the host machine reboots."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Now repeat the "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"dokku postgres:create"}]},{"type":"text","value":" and it is going to succeed. Note, that using "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"binfmt"}]},{"type":"text","value":" might incur a performance hit on some tasks."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Link Postgres service to the app:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"dokku postgres:link railsdatabase"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"At this point, we are ready to "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"git push dokku master"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"However that’s failing due to Dokku version of Node (my test Rails app happens to require Node for Webpacker) being incompatible with the Ampere CPU architecture. We can workaround that by using "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"Dockerfile"}]},{"type":"text","value":" deployment. This isn’t the only alternative - see "},{"type":"element","tagName":"a","properties":{"href":"https://dokku.com/docs/deployment/builders/cloud-native-buildpacks/","target":"_blank","rel":["nofollow"]},"children":[{"type":"text","value":"cloud native buildpacks"}]},{"type":"text","value":" - but that’s the one that worked for me."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"docker-image-deploy","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#docker-image-deploy","ariaLabel":"docker image deploy permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Docker image deploy"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Another reason to consider Dockerfile deploy is that it’s faster. For one, Docker cache skips "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"bundle install"}]},{"type":"text","value":" which takes an awful lot longer on a cloud VM, than locally."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"By default Dokku attempts to autodetect the type of your app (e.g. Rails, Node). If, however, it encounters a "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"Dockerfile"}]},{"type":"text","value":", it simply builds an image and then runs a container. This requires a couple of extra files in our project."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"app.json"}]},{"type":"text","value":":"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"json"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-json"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-json"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","property"]},"children":[{"type":"text","value":"\"name\""}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"Rails testing post\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","property"]},"children":[{"type":"text","value":"\"scripts\""}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","property"]},"children":[{"type":"text","value":"\"dokku\""}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","property"]},"children":[{"type":"text","value":"\"predeploy\""}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"bundle exec rails webpacker:compile\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","property"]},"children":[{"type":"text","value":"\"postdeploy\""}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"bundle exec rails db:migrate\""}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"Dockerfile"}]},{"type":"text","value":":"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"dockerfile"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-dockerfile"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-dockerfile"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","instruction"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"FROM"}]},{"type":"text","value":" ruby:2.7.5"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","instruction"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"RUN"}]},{"type":"text","value":" curl -fsSL https://deb.nodesource.com/setup_16.x | bash -"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","instruction"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"RUN"}]},{"type":"text","value":" apt-get update -qq && apt-get install -y nodejs"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","instruction"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"RUN"}]},{"type":"text","value":" npm install -g yarn"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","instruction"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"WORKDIR"}]},{"type":"text","value":" /app"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","instruction"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"ENV"}]},{"type":"text","value":" RAILS_ENV=production"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","instruction"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"ENV"}]},{"type":"text","value":" PORT=3000"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","instruction"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"ADD"}]},{"type":"text","value":" Gemfile* /app/"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","instruction"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"RUN"}]},{"type":"text","value":" bundle install"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","instruction"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"ADD"}]},{"type":"text","value":" package.json yarn.lock /app/"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","instruction"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"RUN"}]},{"type":"text","value":" yarn install"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","instruction"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"ADD"}]},{"type":"text","value":" . /app/"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","instruction"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"CMD"}]},{"type":"text","value":" bundle exec rails server"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Now we can deploy the app:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"git push dokku master"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The web process might crash because it can’t get "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"secret_key_base"}]},{"type":"text","value":" from encrypted credentials. Just like on Heroku, we can use the CLI to set the necessary environment variable:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"dokku config:set RAILS_MASTER_KEY=$(cat config/master.key)"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Congrats, you’re up! But, unless you set up vhosts, the app is not yet accessible from the Internet."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"adding-domain","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#adding-domain","ariaLabel":"adding domain permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Adding domain"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"dokku domains:add your-domain.dev"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"You need to add an "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"A"}]},{"type":"text","value":" record for your domain that points to the public IP address of your server (or to the vhost, if you created one)."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"setting-up-tls","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#setting-up-tls","ariaLabel":"setting up tls permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Setting up TLS"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Dokku provides a Letsencrypt "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/dokku/dokku-letsencrypt","target":"_blank","rel":["nofollow"]},"children":[{"type":"text","value":"plugin"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Install it on the host:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"sudo dokku plugin:install https://github.com/dokku/dokku-letsencrypt.git"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Then locally:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"dokku config:set --no-restart DOKKU_LETSENCRYPT_EMAIL=your@email.dev\ndokku letsencrypt:enable"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"To enable auto-renew (optional):"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"dokku letsencrypt:cron-job --add"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"serve-assets-from-rails","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#serve-assets-from-rails","ariaLabel":"serve assets from rails permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Serve assets from rails"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"dokku config:set RAILS_SERVE_STATIC_FILES=1"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"console-logs","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#console-logs","ariaLabel":"console logs permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Console logs"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"dokku config:set RAILS_LOG_TO_STDOUT=true"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"papertrail-logs","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#papertrail-logs","ariaLabel":"papertrail logs permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Papertrail logs"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://www.papertrail.com/","target":"_blank","rel":["nofollow"]},"children":[{"type":"text","value":"Papertrail"}]},{"type":"text","value":" is a good logging service with a free tier. Create a log destination and use it as an endpoint in the following command:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"dokku logs:set vector-sink \"papertrail://?endpoint=logs.papertrailapp.com:11111&encoding=text\""}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If this fails for whatever reason it does so silently. You can view vector logs to make sure the above command actually succeeded:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"dokku logs:vector-logs"}]}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"postgres-backups","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#postgres-backups","ariaLabel":"postgres backups permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Postgres backups"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Dokku Postgres let’s you backup to AWS S3."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"dokku postgres:backup-auth railsdatabase $AWS_ACCESS_KEY_ID $AWS_SECRET_ACCESS_KEY"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Create S3 bucket "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"railsdatabase-backup"}]},{"type":"text","value":". Then for one off backup:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"dokku postgres:backup railsdatabase railsdatabase-backup"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"And to setup periodic backups:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"dokku postgres:backup-schedule railsdatabase \"0 3 * * *\" railsdatabase_backup"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"This might give you the following error:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"!     Invalid flag provided, only '--use-iam' allowed"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"This is a very confusing message because it’s got nothing to do with the flags and everything to do with the fact that “0 3 * * *” is being expanded on its way over ssh. Or something along those lines. Anyway, you can run the same command on the remote host without an issue:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"sudo dokku postgres:backup-schedule railsdatabase \"0 3 * * *\" railsdatabase_backup"}]}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"worker","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#worker","ariaLabel":"worker permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Worker"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In order to have more than just one web process, we need to add a "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"Procfile"}]},{"type":"text","value":":"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"web: bundle exec rails server -p $PORT\nworker: bundle exec rails runner 'sleep 1 while true' # dummy example"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"By default Dokku only scales "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"web"}]},{"type":"text","value":" process to 1, so we need to turn on the worker after deploy:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"dokku ps:scale worker=1"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Now we can see that it’s up:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"❯ dokku ps:report\n=====> rails-testing-post ps information\n       Deployed:                      true\n       Processes:                     2\n       Ps can scale:                  true\n       Ps computed procfile path:     Procfile\n       Ps global procfile path:       Procfile\n       Ps procfile path:\n       Ps restart policy:             on-failure:10\n       Restore:                       true\n       Running:                       true\n       Status web 1:                  running (CID: ce5a22a9afe)\n       Status worker 1:               running (CID: e6ab6bac412)"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"continuous-deploy-from-github","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#continuous-deploy-from-github","ariaLabel":"continuous deploy from github permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Continuous deploy from Github"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Use Dokku "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/marketplace/actions/dokku","target":"_blank","rel":["nofollow"]},"children":[{"type":"text","value":"Github action"}]},{"type":"text","value":" to automatically deploy on push to Github."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"useful-free-services","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#useful-free-services","ariaLabel":"useful free services permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Useful free services"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"This is by no means an exhaustive list, but I’ve used these ones and they are good."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://www.skylight.io/","target":"_blank","rel":["nofollow"]},"children":[{"type":"text","value":"Skylight"}]},{"type":"text","value":" for APM"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://rollbar.com","target":"_blank","rel":["nofollow"]},"children":[{"type":"text","value":"Rollbar"}]},{"type":"text","value":" for error notification"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://uptimerobot.com","target":"_blank","rel":["nofollow"]},"children":[{"type":"text","value":"Uptimerobot"}]},{"type":"text","value":" for uptime monitoring"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://sendgrid.com/","target":"_blank","rel":["nofollow"]},"children":[{"type":"text","value":"Sendgrid"}]},{"type":"text","value":" for sending emails"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"caveat","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#caveat","ariaLabel":"caveat permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Caveat"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"There are no free lunches. There are no free servers either. Yes, you can create an Oracle VM for free at (almost) any point, but, as it turned out, it can just as easily vanish at any point. My particular experience was during a week (!) long service disruption when the server got shut down and I wasn’t able to create another one. And then I found out that this happens "},{"type":"element","tagName":"a","properties":{"href":"https://www.reddit.com/r/oraclecloud/comments/pcfvz4/solution_unable_to_start_instance_instance_is/","target":"_blank","rel":["nofollow"]},"children":[{"type":"text","value":"all the time"}]},{"type":"text","value":". I am guessing killing free servers is their coping strategy for when things start falling apart. It’s probably mentioned somewhere deep in the TOS, but I couldn’t find it. I hope Oracle will pull their stuff together (or at least make this very clear upfront). In the meantime, be warned."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"But, perhaps, some things are worth paying for after all. I’ve been using "},{"type":"element","tagName":"a","properties":{"href":"https://contabo.com/en/","target":"_blank","rel":["nofollow"]},"children":[{"type":"text","value":"Contabo"}]},{"type":"text","value":" for a couple of years now and I have NEVER had any issues. For a 5€/month I get a server with enough RAM/CPU/storage/bandwidth to comfortably host a slew of pet projects as well as two Minecraft servers. And no Ampere workarounds required."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"hr","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"There is a Reddit "},{"type":"element","tagName":"a","properties":{"href":"https://www.reddit.com/r/rails/comments/uei7gn/hosting_rails_apps_for_free_on_oracle_cloud_with/","target":"_blank","rel":["nofollow"]},"children":[{"type":"text","value":"discussion"}]},{"type":"text","value":" of this post."}]}],"data":{"quirksMode":false}},"tableOfContents":"<ul>\n<li><a href=\"/blog/hosting-rails-apps-for-free-on-oracle-cloud-with-dokku/#free-hardware\">Free hardware</a></li>\n<li>\n<p><a href=\"/blog/hosting-rails-apps-for-free-on-oracle-cloud-with-dokku/#dokku\">Dokku</a></p>\n<ul>\n<li><a href=\"/blog/hosting-rails-apps-for-free-on-oracle-cloud-with-dokku/#install-dokku\">Install Dokku</a></li>\n<li>\n<p><a href=\"/blog/hosting-rails-apps-for-free-on-oracle-cloud-with-dokku/#deploying-to-dokku\">Deploying to Dokku</a></p>\n<ul>\n<li><a href=\"/blog/hosting-rails-apps-for-free-on-oracle-cloud-with-dokku/#docker-image-deploy\">Docker image deploy</a></li>\n</ul>\n</li>\n<li><a href=\"/blog/hosting-rails-apps-for-free-on-oracle-cloud-with-dokku/#adding-domain\">Adding domain</a></li>\n<li><a href=\"/blog/hosting-rails-apps-for-free-on-oracle-cloud-with-dokku/#setting-up-tls\">Setting up TLS</a></li>\n<li><a href=\"/blog/hosting-rails-apps-for-free-on-oracle-cloud-with-dokku/#serve-assets-from-rails\">Serve assets from rails</a></li>\n<li><a href=\"/blog/hosting-rails-apps-for-free-on-oracle-cloud-with-dokku/#console-logs\">Console logs</a></li>\n<li><a href=\"/blog/hosting-rails-apps-for-free-on-oracle-cloud-with-dokku/#papertrail-logs\">Papertrail logs</a></li>\n<li><a href=\"/blog/hosting-rails-apps-for-free-on-oracle-cloud-with-dokku/#postgres-backups\">Postgres backups</a></li>\n<li><a href=\"/blog/hosting-rails-apps-for-free-on-oracle-cloud-with-dokku/#worker\">Worker</a></li>\n<li><a href=\"/blog/hosting-rails-apps-for-free-on-oracle-cloud-with-dokku/#continuous-deploy-from-github\">Continuous deploy from Github</a></li>\n</ul>\n</li>\n<li><a href=\"/blog/hosting-rails-apps-for-free-on-oracle-cloud-with-dokku/#useful-free-services\">Useful free services</a></li>\n<li><a href=\"/blog/hosting-rails-apps-for-free-on-oracle-cloud-with-dokku/#caveat\">Caveat</a></li>\n</ul>","fields":{"slug":"/blog/hosting-rails-apps-for-free-on-oracle-cloud-with-dokku/","readingTime":{"text":"9 min read"}},"frontmatter":{"date":"April 29, 2022","title":"Hosting Rails apps for free on Oracle Cloud with Dokku","subtitles":null,"author":"Artem Avetisyan","short_description":"Dokku has always been a low effort way to have your own Heroku. And now on a free infrastructure.","hidden":null}}},"pageContext":{"slug":"/blog/hosting-rails-apps-for-free-on-oracle-cloud-with-dokku/","prev":null,"next":{"fileAbsolutePath":"/home/artem/projects/featurist-site-2019/src/data/blog/turbo-and-fast-system-tests/index.md","fields":{"slug":"/blog/turbo-and-fast-system-tests/"},"frontmatter":{"title":"Turbo and fast system tests"}}}},"staticQueryHashes":["2665612806","3649515864"]}